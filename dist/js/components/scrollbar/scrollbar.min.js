(bbn_resolve)=>{((bbn)=>{let script=document.createElement('script');script.innerHTML=`<div :class="componentClass"
      :style="barStyle"
      v-if="isVisible"
      @click="jump($event)"
      @dblclick="jump($event, true)"
      @mouseenter="isOverSlider = true"
      @mouseleave="isOverSlider = false"
>
  <div :class="{
        'bbn-scroll-slider': true,
        'bbn-primary': true,
        'bbn-scroll-not-dragged': !dragging
  }"
        :style="sliderStyle"
        ref="scrollSlider"
        @touchstart="startDrag"
        @mousedown="startDrag">
  </div>
</div>`;script.setAttribute('id','bbn-tpl-component-scrollbar');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);let css=document.createElement('link');css.setAttribute('rel',"stylesheet");css.setAttribute('href',bbn.vue.libURL+"dist/js/components/scrollbar/scrollbar.css");document.head.insertAdjacentElement('beforeend',css);(function(bbn,Vue){"use strict";Vue.component('bbn-scrollbar',{mixins:[bbn.vue.basicComponent,bbn.vue.keepCoolComponent],props:{orientation:{required:true,type:String},scroller:{type:Vue,default(){return this.$parent.$options._componentTag==='bbn-scroll'?this.$parent:null;}},container:{type:HTMLElement},hidden:{type:[String,Boolean],default:'auto'},tolerance:{type:Number,default:2},scrolling:{type:Number,default:0},scrollAlso:{type:[HTMLElement,Array,Function],default(){return[];}},initial:{type:[Number,Object],default:0},color:{type:String},minSize:{type:Number,default:20},offset:{type:[Number,Array],default(){return[0,0];}}},data(){return{realContainer:this.container?this.container:(this.scroller?this.scroller.getRef('scrollContainer'):false),containerSize:0,contentSize:0,containerPos:0,sliderPos:bbn.fn.isArray(this.offset)?this.offset[0]:this.offset,dragging:false,size:100,start:0,position:this.scrolling,currentScroll:0,moveTimeout:0,show:this.hidden==='auto'?false:!this.hidden,scroll:this.initial,isReaching:false,isActive:false,isOverSlider:false,animationInterval:false,nextLevel:false};},computed:{shouldBother(){return this.contentSize>this.containerSize;},ratio(){if(this.shouldBother){return(this.containerSize-this.offsetStart-this.offsetEnd)/ this.contentSize;}
return 1;},sliderSize(){if(this.shouldBother){let size=Math.round(this.containerSize*this.ratio);if(size<this.minSize){size=this.minSize;}
return size;}
return 0;},maxSliderPos(){return this.shouldBother?this.containerSize-this.sliderSize-this.offsetStart-this.offsetEnd:0;},offsetStart(){return(bbn.fn.isArray(this.offset)?this.offset[0]:this.offset);},offsetEnd(){return(bbn.fn.isArray(this.offset)?this.offset[1]:this.offset);},barStyle(){return{opacity:this.show&&this.shouldBother?1:0,[this.isVertical?'top':'left']:this.offsetStart+'px',[this.isVertical?'bottom':'right']:this.offsetEnd+'px'}},sliderStyle(){let res={};if(this.shouldBother){res[this.isVertical?'height':'width']=this.sliderSize+'px';res[this.isVertical?'top':'left']=this.sliderPos+'px';if(this.color){res.backgroundColor=this.color;}}
return res;},isVertical(){return this.orientation!=='horizontal';},realSize(){return this.containerSize?this.containerSize / 100*this.size:0;},isVisible(){return(this.hidden!==true)&&((this.scroller&&this.scroller.isFocused)&&this.isActive||this.isActive);},},methods:{startDrag(e){if(this.realContainer){e.preventDefault();e.stopPropagation();e=e.changedTouches?e.changedTouches[0]:e;this.dragging=true;this.start=this.isVertical?e.pageY:e.pageX;}},onDrag(e){if(this.realContainer&&this.dragging&&this.containerSize){this.keepCool(()=>{e=e.changedTouches?e.changedTouches[0]:e;let newStart=this.isVertical?e.pageY:e.pageX;let movement=newStart-this.start;if(movement&&this.setSliderPos(this.sliderPos+movement)){this.adjustFromBar();}
this.start=newStart;})}},stopDrag(){this.dragging=false;},setSliderPos(pos){if(bbn.fn.isNumber(pos)){if(pos<0){pos=0;}
if(pos>this.maxSliderPos){pos=this.maxSliderPos;}
if(this.sliderPos!==pos){this.sliderPos=pos;return true;}}
return false;},adjustFromContainer(container){if(this.shouldBother&&!this.dragging){let prop=this.isVertical?'scrollTop':'scrollLeft';let ok=false;if(!container){container=this.realContainer;if(this.scroller){this.containerPos=this.scroller['current'+(this.isVertical?'Y':'X')];ok=true;}}
if(!ok){this.containerPos=container[prop];}
this.setSliderPos(this.containerPos*this.ratio);bbn.fn.each(this.scrollableElements(),(a)=>{if(a!==container){a[prop]=this.containerPos;}});this.overContent();}},adjustFromBar(){if(this.shouldBother){this.containerPos=(this.sliderPos / this.ratio);let prop=this.isVertical?'scrollTop':'scrollLeft';this.realContainer[prop]=this.containerPos;bbn.fn.each(this.scrollableElements(),(a)=>{a[prop]=this.containerPos;});let e=new Event('scroll');this.$emit('scroll'+(this.isVertical?'y':'x'),e,this.containerPos);}},jump(e,precise){if(this.realContainer){let isRail=e.target===this.$el;if(isRail){let position=this.$refs.scrollSlider.getBoundingClientRect();let clickPoint=this.isVertical?e.pageY:e.pageX;let isBefore=clickPoint<position[this.isVertical?'top':'left'];let isAfter=clickPoint>position[this.isVertical?'bottom':'right'];if(isBefore||isAfter){let movement=isBefore?-(position[this.isVertical?'top':'left']-clickPoint):clickPoint-(position[this.isVertical?'top':'left'])-(position[this.isVertical?'height':'width']);if(!precise){if(isBefore){this.scrollBefore();}
else{this.scrollAfter();}}
else if(this.setSliderPos(this.sliderPos+movement)){this.adjustFromBar();}}}}},scrollLevel(before){if(this.sliderSize){let movement=Math.round(this.sliderSize-(this.sliderSize*0.1));if(before){movement=-movement;}
if(this.setSliderPos(this.sliderPos+movement)){this.adjustFromBar();}}},scrollBefore(){return this.scrollLevel(true);},scrollAfter(){return this.scrollLevel();},scrollableElements(){let tmp=this.scrollAlso;if(bbn.fn.isFunction(tmp)){tmp=tmp();}
else if(!Array.isArray(tmp)){tmp=[tmp];}
let res=[];if(bbn.fn.isArray(tmp)){bbn.fn.each(tmp,(a)=>{if(a){res.push(a)}})}
return res;},onResize(){if(this.realContainer){let tmp1,tmp2;if(this.scroller){tmp1=this.scroller[this.isVertical?'lastKnownHeight':'lastKnownWidth'];tmp2=this.scroller[this.isVertical?'contentHeight':'contentWidth'];}
else{tmp1=this.isVertical?this.realContainer.clientHeight:this.realContainer.clientWidth;tmp2=this.realContainer[this.isVertical?'scrollHeight':'scrollWidth']||tmp1;}
if(tmp1<20){this.containerSize=0;this.contentSize=0;this.size=0;this.isActive=false;return;}
if((tmp1!==this.containerSize)||(tmp2!==this.contentSize)){this.containerSize=tmp1||0;this.contentSize=tmp2||0;}
this.isActive=this.contentSize>this.containerSize+2;}
else{this.isActive=false;this.initContainer();if(this.realContainer){this.onResize();}}},initContainer(){if(!this.realContainer&&this.scroller){this.realContainer=this.scroller.getRef('scrollContainer');}
if(this.realContainer&&!this.isInit){this.onResize();if(!this.container&&this.scroller){this.scroller.$on("resize",this.onResize);this.scrollTo(this.initial);this.scroller.$on("scroll",()=>{this.adjustFromContainer()});this.scroller.$on("mousemove",this.overContent);}
else{this.realContainer.addEventListener("mousemove",this.overContent);this.realContainer.addEventListener('scroll',()=>{this.adjustFromContainer();});}
bbn.fn.each(this.scrollableElements(),(a)=>{a.addEventListener('scroll',()=>{this.adjustFromContainer(a);},{passive:true});a.addEventListener('scroll',this.overContent)});}},overContent(){this.keepCool(()=>{clearTimeout(this.moveTimeout);if(!this.show){this.show=true;}
this.moveTimeout=setTimeout(()=>{if(!this.isOverSlider){this.hideSlider();}},500);},'overContent',250)},showSlider(){clearTimeout(this.moveTimeout);if(!this.show){this.show=true;}},hideSlider(){if(!this.dragging&&this.show){this.show=false;}},animateBar(){return;if(this.$refs.scrollSlider){let anim={};if(this.isVertical){anim.height=this.size+'%';anim.top=this.position+'%';}
else{anim.width=this.size+'%';anim.left=this.position+'%';}}},smoothScrollTo(end,duration){return new Promise((resolve,reject)=>{const start=this.realContainer['scroll'+(this.isVertical?'Top':'Left')];const distance=end-start;const startTime=new Date().getTime();duration=typeof duration!=='undefined'?duration:400;const easeInOutQuart=(time,from,distance,duration)=>{if((time /=duration / 2)<1)return distance / 2*time*time*time*time+from;return-distance / 2*((time-=2)*time*time*time-2)+from;};if(this.animationInterval){clearInterval(this.animationInterval);}
this.animationInterval=setInterval(()=>{const time=new Date().getTime()-startTime;let newPos=easeInOutQuart(time,start,distance,duration);if(time>=duration){clearInterval(this.animationInterval);newPos=end;resolve();}
this.nextLevel=Math.round(newPos);this.realContainer['scroll'+(this.isVertical?'Top':'Left')]=newPos;},1000 / 60);});},scrollTo(val,anim=false){return new Promise(resolve=>{if(this.shouldBother){if(this.animationInterval){clearInterval(this.animationInterval);}
let num=0;let ele=false;if(bbn.fn.isVue(val)&&val.$el){ele=val.$el;}
else if(bbn.fn.isDom(val)){ele=val;}
if(ele){let container=ele.offsetParent;num=ele[this.isVertical?'offsetTop':'offsetLeft']
-Math.round(this.containerSize/2);while(container&&(container!==this.scroller.$el)){if(container.contains(this.scroller.$el)){break;}
else{num+=container[this.isVertical?'offsetTop':'offsetLeft'];container=container.offsetParent;}}}
else if(bbn.fn.isPercent(val)){num=Math.round(parseFloat(val)*this.contentSize / 100);}
else if(bbn.fn.isNumber(val)){num=val;}
if(bbn.fn.isNumber(num)){bbn.fn.log("Scroolto 1",num);if(num<0){num=0;}
else if(num>(this.contentSize-this.containerSize+100)){num=this.contentSize-this.containerSize;}
bbn.fn.log("Scroolto 1",num);this.containerPos=num;this.sliderPos=this.containerPos*this.ratio;if(anim){this.smoothScrollTo(num).then(()=>{resolve();});}
else{this.nextLevel=Math.round(num);this.realContainer['scroll'+(this.isVertical?'Top':'Left')]=num;resolve();}}}});},scrollStart(){this.scrollTo(0);},scrollEnd(){this.scrollTo(this.contentSize-this.containerSize);}},watch:{isOverSlider(v){if(!this.dragging){if(!v){this.overContent();}
else if(!this.show){this.showSlider();}}},container(){this.initContainer();},show(v){if(v){this.onResize();}},sliderPos(){this.showSlider();},dragging(v){if(this.scroller){this.scroller.isDragging=v}}},created(){this.componentClass.push(this.orientation);},mounted(){this.initContainer();document.addEventListener("mousemove",this.onDrag);document.addEventListener("touchmove",this.onDrag);document.addEventListener("mouseup",this.stopDrag);document.addEventListener("touchend",this.stopDrag);this.onResize();this.overContent();},beforeDestroy(){if(this.realContainer&&this.isInit){if(!this.container&&this.scroller){this.scroller.$off("resize",this.onResize);this.scroller.$off("scroll",this.adjust);this.scroller.$off("mousemove",this.overContent);}
else{this.realContainer.removeEventListener('scroll',this.adjust,{passive:true});this.realContainer.removeEventListener('mousemove',this.overContent,{passive:true});}
bbn.fn.each(this.scrollableElements(),(a)=>{a.removeEventListener('scroll',this.adjust,{passive:true});a.removeEventListener('mousemove',this.overContent,{passive:true});});}
document.removeEventListener("mousemove",this.onDrag);document.removeEventListener("touchmove",this.onDrag);document.removeEventListener("mouseup",this.stopDrag);document.removeEventListener("touchend",this.stopDrag);},});})(window.bbn,window.Vue);if(bbn_resolve){bbn_resolve("ok");}})(bbn);}