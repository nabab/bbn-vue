(bbn_resolve)=>{((bbn)=>{let script_dep=document.createElement('script');script_dep.setAttribute('src',"https://cdn.jsdelivr.net/combine/gh/ashraymehta/codemirror-bundler@1.0.0/dist/codemirror.js");script_dep.onload=()=>{let script=document.createElement('script');script.innerHTML=`<div :class="[{'bbn-reset': true, 'bbn-overlay': isFullScreen}, componentClass]"
     @keydown.enter.stop=""
     @keydown.escape.stop="toggleFullScreen(false)"
>
  <div :class="fill ? 'bbn-code-filled' : ''"
      ref="code"
      @focus="focus($event)"
      @blur="blur($event)"
      @keydown="keydown($event)"
      @keyup="keyup($event)"
      @mouseenter="over($event)"
      @mouseleave="out($event)"
      @scroll.passive="scroll($event)"
  ></div>
  <input ref="element"
        type="hidden"
        :value="value"
        :name="name"
        :disabled="disabled"
        :required="required"
  >
  <div class="bbn-bg-black bbn-p bbn-middle theme-button"
      v-if="themeButton"
      ref="theme_button"
  >
    <i class="nf nf-fa-bars" @click="nextTheme()"> </i>
  </div>
  <bbn-scrollbar v-if="fill && ready"
                orientation="vertical"
                :container="$el.querySelector('.CodeMirror-scroll')">
  </bbn-scrollbar>
</div>
`;script.setAttribute('id','bbn-tpl-component-code2');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);let css=document.createElement('link');css.setAttribute('rel',"stylesheet");css.setAttribute('href',bbn.vue.libURL+"dist/js/components/code2/code2.css");document.head.insertAdjacentElement('beforeend',css);(bbn=>{"use strict";Vue.component('bbn-code2',{mixins:[bbn.vue.basicComponent,bbn.vue.inputComponent,bbn.vue.eventsComponent],props:{ecma:{type:Number,default:6},mode:{type:[String,Object],default:'php'},theme:{type:String,},fill:{type:Boolean,default:true},cfg:{type:Object,default:function(){return{};}},themeButton:{type:Boolean,default:false}},data(){return{widget:null,isFullScreen:false};},computed:{currentTheme(){return this.theme?this.theme:this.defaultTheme;}},methods:{getMode(mode){if(modes[mode]){let o=bbn.fn.clone(modes[mode]);o.gutters=["CodeMirror-linenumbers","CodeMirror-foldgutter"];if(o.lint){o.gutters=["CodeMirror-lint-markers"]}
return o;}
return false;},getOptions(){let tmp,cfg=bbn.fn.extend({},baseCfg,{mode:this.mode,theme:this.currentTheme,value:this.value},this.cfg);if(this.readonly||this.disabled){cfg.readOnly=true;}
if(tmp=this.getMode(this.mode)){bbn.fn.extend(true,cfg,tmp);}
return cfg;},cursorPosition(lineCode,position){let ctrl=false;if(lineCode<=this.widget.doc.lineCount()-1){if(position<=this.widget.doc.lineInfo(lineCode).text.length){ctrl=true;}}
if(ctrl){this.$nextTick(()=>{this.widget.focus();this.widget.setCursor({line:lineCode,ch:position});});}
else{return false}},getState(){if(this.widget){let doc=this.widget.getDoc(),selections=doc.listSelections(),marks=doc.getAllMarks(),info=doc.getCursor(),res={selections:[],marks:[],line:info.line,char:info.ch};if(marks){for(let i=marks.length-1;i>=0;i--){if(marks[i].collapsed&&(marks[i].type==='range')){res.marks.push(marks[i].find().from);}}}
if(selections){bbn.fn.each(selections,a=>{res.selections.push({anchor:a.anchor,head:a.head});});}
return res;}
return false;},loadState(obj){this.widget.focus();let doc=this.widget.getDoc();if(obj.marks&&obj.marks.length){for(let mark of obj.marks){this.widget.foldCode(mark.line,0);}}
if(obj.line>0||obj.char>0){this.cursorPosition(obj.line,obj.char);}
else{if(obj.selections&&obj.selections.length&&(obj.line===0&&obj.char===0)){for(let i=0;i<obj.selections.length;i++){doc.setSelection(obj.selections);}}}},nextTheme(){themeIndex++;if(themeIndex>=themes.length){themeIndex=0;}
bbn.vue.defaults.code.theme=themes[themeIndex];this.widget.setOption("theme",themes[themeIndex]);},foldByLevel(level){this.foldByNodeOrder(0);var cursor=this.widget.getCursor();cursor.ch=0;cursor.line=0;var range=this.widget.getViewport();this.foldByLevelRec(cursor,range,level);},foldByLevelRec(cursor,range,level){if(level>0){var searcher=this.widget.getSearchCursor("<",cursor,false);while(searcher.findNext()&&searcher.pos.from.line<range.to){this.widget.foldCode(searcher.pos.from,null,"unfold");cursor=searcher.pos.from;cursor.ch=searcher.pos.from.ch+1;var match=CodeMirror.findMatchingTag(this.widget,cursor,range);if(match){if(match.close){var innerrange={from:range.from,to:range.to};innerrange.from=cursor.line+1;innerrange.to=match.close.to.line;this.foldByLevelRec(cursor,innerrange,level-1);}
var nextcursor={line:cursor.line,to:cursor.ch};if(match.close){nextcursor.line=match.close.to.line;}
nextcursor.ch=0;nextcursor.line=nextcursor.line+1;searcher=this.widget.getSearchCursor("<",nextcursor,false);}}}},foldByNodeOrder(node){this.unfoldAll();node++;for(var l=this.widget.firstLine();l<=this.widget.lastLine();++l){if(node==0){this.widget.foldCode({line:l,ch:0},null,"fold");}
else{node--;}}},foldAll(){this.foldByNodeOrder(0);},unfoldAll(){for(var i=0;i<this.widget.lineCount();i++){this.widget.foldCode({line:i,ch:0},null,"unfold");}},initTern(){if(this.mode==='js'){if(bbn.vue.tern===undefined){let getURL=(url,c)=>{let xhr=new XMLHttpRequest();xhr.open("get",url,true);xhr.send();xhr.onreadystatechange=function(){if(xhr.readyState!=4)return;if(xhr.status<400)return c(null,xhr.responseText);let e=new Error(xhr.responseText||"No response");e.status=xhr.status;c(e);};};getURL("https://raw.githubusercontent.com/ternjs/tern/master/defs/ecmascript.json",(err,code)=>{if(err){throw new Error("Request for ecmascript.json: "+err);}
if(this.widget&&code){let defs=JSON.parse(code);defs.bbn={fn:{},vue:{}};bbn.fn.iterate(bbn.fn,(a,k)=>{defs.bbn.fn[k]={"!type":"fn(number) -> number","!url":"https://doc.js.bbn.solutions/"+k,"!doc":"Returns the value of a number rounded to the nearest integer."}});bbn.fn.iterate(bbn.vue,(a,k)=>{defs.bbn.vue[k]={"!type":"fn(number) -> number","!url":"https://doc.js.bbn.solutions/"+k,"!doc":"Returns the value of a number rounded to the nearest integer."}});bbn.vue.tern=new CodeMirror.TernServer({defs:[defs]});this.widget.on("cursorActivity",function(cm){bbn.vue.tern.updateArgHints(cm);});}});}
else{this.widget.on("cursorActivity",function(cm){bbn.vue.tern.updateArgHints(cm);});}}},addSnippet(code){if(code===undefined){code="";}
this.widget.focus();let replace=this.widget.getDoc().replaceRange,state=this.getState(),position={line:state.line-1,ch:state.char};this.widget.getDoc().replaceRange("\n"+code+"\n",position);},toggleFullScreen(isFS){if(isFS===undefined){isFS=!this.isFullScreen;}
this.isFullScreen=!!isFS;}},mounted(){let el=this.getRef('code');let cp=this;if(el){let state=CodeMirror.EditorState.create({doc:this.value,extensions:[CodeMirror.ViewPlugin.fromClass(class{constructor(view){}
update(update){if(update.docChanged){let v=update.state.doc.toString();cp.emitInput(v);bbn.fn.log("CHANGE",update,v)}}}),CodeMirror.basicSetup,CodeMirror.javascript()]});this.widget=new CodeMirror.EditorView({parent:el,state:state});this.$nextTick(()=>{this.ready=true;});}},watch:{currentTheme(newVal){this.widget.setOption("theme",newVal);},mode(newVal){let mode=this.getMode(newVal);if(mode){bbn.fn.each(mode,(v,i)=>{this.widget.setOption(i,v);});}},value(newVal,oldVal){}}});})(bbn);if(bbn_resolve){bbn_resolve("ok");}};document.head.insertAdjacentElement("beforeend",script_dep);})(bbn);}