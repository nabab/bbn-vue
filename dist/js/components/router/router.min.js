(bbn_resolve)=>{((bbn)=>{let script=document.createElement('script');script.innerHTML=`<div :class="[componentClass, {
       'bbn-invisible': !ready,
       'bbn-overlay': nav,
     }]">
  <div :class="{
        'bbn-flex-height': nav,
        'bbn-router-nav': nav,
        'bbn-router-nav-bc': nav && isBreadcrumb,
        'bbn-overlay': !nav
      }">
    <!-- START OF BREADCRUMB -->
    <div v-if="nav && isBreadcrumb"
        ref="breadcrumb"
        :class="['bbn-router-breadcrumb', {'bbn-router-breadcrumb-master': master}]">
      <div v-if="master"
          class="bbn-router-breadcrumb-container">
        <div class="bbn-h-100 bbn-alt bbn-bordered-bottom bbn-no-border-top bbn-no-border-right bbn-vmiddle"
            :style="{
              backgroundColor: getBackgroundColor(selected),
              color: getFontColor(selected)
            }">
          <div class="bbn-flex-width bbn-h-100 bbn-vmiddle">
            <template v-if="breadcrumbs.length"
                      v-for="(bc, i) in breadcrumbs">
              <div v-if="i > 0">
                <i class="nf nf-fa-angle_right bbn-hsmargin bbn-large bbn-router-breadcrumb-arrow"/>
              </div>
              <bbn-context :source="bc.getList(i)"
                            tag="div"
                            min-width="10em"
                            tabindex="0"
                            :item-component="$options.components.listItem"
                            class="bbn-h-100 bbn-vmiddle"
                            :attach="itsMaster ? (itsMaster.getRef('breadcrumb') || undefined) : undefined"
                            :autobind="false"
                            :style="{
                              backgroundColor: bc.getBackgroundColor(bc.selected),
                              color: bc.getFontColor(bc.selected)
                            }">
                <bbn-context :source="bc.getMenuFn"
                             :source-index="isNumber(bc.selected) ? bc.selected : undefined"
                             tag="div"
                             min-width="10em"
                             tabindex="0"
                             :context="true"
                             :autobind="false"
                             class="bbn-vmiddle bbn-h-100">
                  <div class="bbn-vmiddle bbn-h-100">
                    <div class="bbn-router-breadcrumb-badge-container bbn-middle"
                          v-if="isNumber(bc.selected) && bc.views[bc.selected] && numProperties(bc.views[bc.selected].events)">
                      <span class="bbn-badge bbn-small bbn-bg-red"
                            v-text="numProperties(bc.views[bc.selected].events)"/>
                    </div>
                    <div class="bbn-router-breadcrumb-loader bbn-border-text"
                        :style="{borderColor: isNumber(bc.selected) && bc.views[bc.selected] && bc.views[bc.selected].fcolor ? bc.views[bc.selected].fcolor : null}"
                        v-show="isNumber(bc.selected) && bc.views[bc.selected] && bc.views[bc.selected].loading"/>
                    <div :class="[
                           'bbn-router-breadcrumb-element',
                           'bbn-h-100',
                           'bbn-vmiddle',
                           {
                            'bbn-router-breadcrumb-dirty': isNumber(bc.selected)
                                                          && bc.views[bc.selected]
                                                          && !!bc.views[bc.selected].dirty
                          }
                         ]">
                      <span v-if="isNumber(bc.selected) && bc.views[bc.selected] && bc.views[bc.selected].icon"
                            :title="bc.views[bc.selected].title"
                            :class="'bbn-router-breadcrumb-element-icon bbn-h-100 bbn-vmiddle bbn-right-xsspace' + (bc.views[bc.selected].notext ? ' bbn-lg' : ' bbn-m')">
                        <i :class="bc.views[bc.selected].icon"
                            style="zoom: 1.1"/>
                      </span>
                      <span v-if="isNumber(bc.selected) && bc.views[bc.selected] && !bc.views[bc.selected].notext"
                            :class="['bbn-router-breadcrumb-element-text', {'bbn-b': !breadcrumbs[i+1]}]"
                            :title="bc.views[bc.selected].title && (bc.views[bc.selected].title.length > bc.maxTitleLength) ? bc.views[bc.selected].title : ''"
                            v-html="bc.views[bc.selected].title ? bc.cutTitle(bc.views[bc.selected].title) : _('Untitled')"/>
                    </div>
                    <i v-if="isNumber(bc.selected)
                              && bc.views[bc.selected]
                              && !bc.views[bc.selected].static
                              && !bc.views[bc.selected].pinned"
                         class="nf nf-fa-times bbn-p bbn-router-breadcrumb-close bbn-router-breadcrumb-icon"
                         @click.prevent.stop="bc.close(bc.selected)"/>
                    <i v-if="isNumber(bc.selected) && bc.views[bc.selected] && bc.views[bc.selected].menu"
                       class="nf nf-fa-caret_down bbn-router-breadcrumb-menu bbn-router-breadcrumb-icon bbn-p"
                       @click.prevent.stop="openMenu($event)"/>
                  </div>
                </bbn-context>
              </bbn-context>
            </template>
            <div v-if="breadcrumbs.length"
                 class="bbn-flex-fill bbn-h-100"
                 :style="{
                   backgroundColor: breadcrumbs[breadcrumbs.length-1].getBackgroundColor(breadcrumbs[breadcrumbs.length-1].selected),
                   color: breadcrumbs[breadcrumbs.length-1].getFontColor(breadcrumbs[breadcrumbs.length-1].selected)
                 }">
              &nbsp;
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- END OF BREADCRUMB -->
    <!-- START OF TABS -->
    <div v-else-if="nav && !isBreadcrumb"
         :class="['bbn-router-tabs', {'bbn-router-tabs-scrollable': scrollable}]"
         ref="tabs">
      <div class="bbn-router-tabs-container">
        <div class="bbn-router-tabs-ul-container">
          <div class="bbn-flex-width">
            <div v-if="scrollable"
                class="bbn-router-tabs-button bbn-router-tabs-button-prev bbn-p">
              <div class="bbn-100 bbn-middle"
                  @click="scrollTabs('left')">
                <div class="bbn-block">
                  <i class="nf nf-fa-angle_left bbn-xlarge"/>
                </div>
              </div>
            </div>
            <div class="bbn-flex-fill">
              <component :is="scrollable ? 'bbn-scroll' : 'div'"
                          ref="horizontal-scroll"
                          v-bind="scrollCfg">
                <ul ref="tabgroup"
                    class="bbn-alt bbn-router-tabs-tabs bbn-bordered-bottom bbn-flex-fill">
                  <li v-for="(tab, tabIndex) in views"
                      @click="!tab.disabled && (tabIndex !== selected) ? activateIndex(tabIndex) : false"
                      :ref="'tab-' + tabIndex"
                      v-show="!tab.hidden"
                      :style="{
                        backgroundColor: tab.bcolor || null,
                        color: tab.fcolor || null
                      }"
                      :data-index="tabIndex"
                      :class="['bbn-iblock', 'bbn-bordered', 'bbn-radius-top', 'bbn-state-default', 'bbn-unselectable', {
                        'bbn-router-tabs-static': !!tab.static,
                        'bbn-background-effect-internal': tabIndex === selected,
                        'bbn-router-tabs-active': tabIndex === selected,
                        'bbn-disabled': tab.disabled,
                        'bbn-router-tabs-alarm': tab.alarm
                      }, tab.cls || '']">
                    <div class="bbn-router-tabs-badge-container bbn-middle"
                          v-if="numProperties(tab.events)">
                      <span class="bbn-badge bbn-small bbn-bg-red"
                            v-text="numProperties(tab.events)"/>
                    </div>
                    <div class="bbn-router-tabs-tab-loader bbn-border-text"
                          :style="{borderColor: tab.fcolor || null}"
                          v-show="tab.loading"/>
                    <bbn-context :context="true"
                                 @keydown.space.enter.prevent.stop="tabIndex !== selected ? activateIndex(tabIndex) : false"
                                 @keydown.right.down.prevent.stop="getRef('menu-' + tabIndex) ? getRef('menu-' + tabIndex).$el.focus() : (getRef('closer-' + tabIndex) ? getRef('closer-' + tabIndex).focus() : null)"
                                 :source="getMenuFn"
                                 :source-index="tabIndex"
                                 :autobind="false"
                                 tag="div"
                                 :disabled="tabIndex !== selected"
                                 min-width="10em"
                                 :class="['bbn-router-tabs-tab', 'bbn-iblock', {
                                   'bbn-router-tabs-dirty': tab.dirty,
                                   'bbn-router-tabs-icononly': tab.notext
                                 }]"
                                 :ref="'title-' + tabIndex"
                                 :style="{
                                   color: tab.fcolor ? tab.fcolor : null
                                 }"
                                 tabindex="0">
                      <span v-if="tab.icon"
                            :title="tab.title"
                            :class="'bbn-router-tabs-main-icon bbn-iblock' + (tab.notext ? ' bbn-lg' : ' bbn-m')">
                        <i :class="tab.icon"
                            :style="{zoom: iconsReady ? 1.1 : 1}"/>
                      </span>
                      <span v-if="!tab.notext && tab.title"
                            class="bbn-router-tab-text"
                            :title="getFullTitle(tab)"
                            v-html="tab.title.length > maxTitleLength ? cutTitle(tab.title) : tab.title"/>
                    </bbn-context>
                    <div class="bbn-router-tabs-selected"
                          :ref="'selector-' + tabIndex"
                          v-show="tabIndex === selected"
                          :style="{
                            backgroundColor: getFontColor(tabIndex)
                          }"/>
                    <div class="bbn-router-tabs-icon">
                      <i v-if="!tab.static && !tab.pinned"
                        class="nf nf-fa-times bbn-p bbn-router-tab-close"
                        tabindex="-1"
                        :ref="'closer-' + tabIndex"
                        @keydown.left.down.prevent.stop="getRef('menu-' + tabIndex) ? getRef('menu-' + tabIndex).$el.focus() : null"
                        @keydown.space.enter.prevent.stop="close(tabIndex)"
                        @click.stop.prevent="close(tabIndex)"/>
                      <bbn-context v-if="(tab.menu !== false) && (tabIndex === selected)"
                                  class="nf nf-fa-caret_down bbn-router-tab-menu bbn-p"
                                  tabindex="-1"
                                  min-width="10em"
                                  tag="i"
                                  :source="getMenuFn"
                                  :autobind="false"
                                  :source-index="tabIndex"
                                  :ref="'menu-' + tabIndex"/>
                    </div>
                  </li>
                </ul>
              </component>
            </div>
            <div v-if="scrollable"
              class="bbn-router-tabs-button bbn-router-tabs-button-next bbn-p">
              <div class="bbn-100 bbn-middle"
                   @click="scrollTabs('right')">
                <div class="bbn-block">
                  <i class="nf nf-fa-angle_right bbn-xlarge"/>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- END OF TABS -->
    <!-- START OF CONTENT -->
    <div :class="{
           'bbn-flex-fill': !!nav,
           'bbn-overlay': !nav
         }"
         v-if="ready">
      <slot></slot>
      <bbn-container v-for="view in views"
                     v-if="!view.real && !component"
                     :key="view.url"
                     v-bind="view"/>
      <bbn-container v-if="component && componentSource && componentUrl"
                     :source="componentSource"
                     :component="component"
                     :url="componentSource[componentUrl]"/>
    </div>
    <!-- END OF CONTENT -->
  </div>
</div>`;script.setAttribute('id','bbn-tpl-component-router');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);let css=document.createElement('link');css.setAttribute('rel',"stylesheet");css.setAttribute('href',bbn.vue.libURL+"dist/js/components/router/router.css");document.head.insertAdjacentElement('beforeend',css);(function(bbn,Vue){"use strict";Vue.component("bbn-router",{name:'bbn-router',mixins:[bbn.vue.basicComponent,bbn.vue.localStorageComponent,bbn.vue.closeComponent,bbn.vue.observerComponent],props:{auto:{type:Boolean,default:true},url:{type:String,default:''},autoload:{type:Boolean,default:true},root:{type:String,default:''},def:{type:String},source:{type:Array,default(){return[];}},single:{type:Boolean,default:false},nav:{type:Boolean,default:false},scrollable:{type:Boolean,default:false},storageName:{type:String,default:'__ROOT__'},confirmLeave:{type:[Boolean,String,Function],default:bbn._("Are you sure you want to discard the changes you made in this page?")},hideAdvertUrl:{type:String},historyMaxLength:{type:Number,default:10},menu:{type:[Array,Function],default:function(){return[];}},breadcrumb:{type:Boolean,default:false},master:{type:Boolean,default:false},postBaseUrl:{type:Boolean,default:true},showSwitch:{type:Boolean,default:true},component:{type:[String,Object]},componentSource:{type:Object},componentUrl:{type:String},maxTitleLength:{type:Number,default:20},disabled:{type:Boolean,default:false},urlNavigation:{type:Boolean,default:true},ignoreDirty:{type:Boolean,default:false}},data(){return{numRegistered:0,hasRealContainers:false,hasFakeContainers:false,hasEmptyURL:false,cfgViews:[].concat(this.source),slotViews:[],views:[],urls:{},currentTitle:'',currentURL:this.url||'',baseURL:this.setBaseURL(this.root),parents:[],parent:null,router:null,parentContainer:null,visible:true,activeContainer:null,isLoading:false,routed:false,isRouting:false,isInit:false,selected:null,dirtyContainers:[],history:[],iconsReady:false,isBreadcrumb:this.breadcrumb,breadcrumbWatcher:false,breadcrumbsList:[]};},computed:{fullBaseURL(){let vm=this,base='',tmp;while(tmp=vm.baseURL){base=tmp+base;if(!vm.parents.length){break;}
vm=vm.parents[0];}
return base;},isDirty(){return!!this.dirtyContainers.length;},itsMaster(){if(this.master){return this;}
return bbn.fn.getRow(this.parents,{master:true})},itsTabs(){if(!this.isBreadcrumb){return this.getRef('tabs');}
return false;},activeRealContainer(){if(bbn.fn.isNumber(this.selected)){return this.getRealVue(this.selected);}
return false;},activeRouter(){if(this.activeContainer){let sub=this.getSubRouter(this.selected);if(bbn.fn.isVue(sub)){return sub.activeRouter;}}
return this;},scrollCfg(){return this.scrollable?{axis:'x',container:true,hidden:true}:{};},breadcrumbs(){let res=[];if(this.isBreadcrumb){res.push(this)}
if(this.breadcrumbsList.length){res.push(...this.getBreadcrumbs(this.selected))}
return res;}},methods:{isNumber:bbn.fn.isNumber,numProperties:bbn.fn.numProperties,register(cp,fake){if(fake){this.add(cp);return;}
if(!bbn.fn.isString(cp.url)){throw Error(bbn._('The component bbn-container must have a URL defined'));}
if(this.urls[cp.url]){throw Error(bbn._('Two containers cannot have the same URL defined ('+cp.url+')'));}
this.numRegistered++;this.urls[cp.url]=cp;let idx=this.search(cp.url);if(idx===false){this.add(cp);}
else{cp.currentIndex=idx;if(!this.isInit&&(this.numRegistered===this.views.length)){this.isInit=true;if(this.auto){this.route(this.single?cp.url:this.getDefaultURL(),true);}}}
this.$emit('registered',cp.url)},unregister(cp){if(!bbn.fn.isString(cp.url)){throw Error(bbn._('The component bbn-container must have a URL defined'));}
this.numRegistered--;let idx=this.search(cp.url),dataObj=this.postBaseUrl?{_bbn_baseURL:this.fullBaseURL}:{},requestID=bbn.fn.getRequestId(cp.url,dataObj);if(bbn.fn.getLoader(requestID)){bbn.fn.abort(requestID);}
if(this.urls[cp.url]!==undefined){delete this.urls[cp.url];}
if(idx!==false){this.remove(idx);}
if(this.isInit&&(this.views.length!==this.numRegistered)){this.isInit=false;}},getRoute(url,force){if(!bbn.fn.isString(url)){bbn.fn.log("error in getRoute with url",url);throw Error(bbn._('The component bbn-container must have a valid URL defined'));}
if(!url&&this.hasEmptyURL){return'';}
if(!url&&!this.parent){url=this.parseURL(bbn.env.path);}
if(!url&&force&&this.parent){url=this.parseURL(this.router.getFullCurrentURL());}
if(url){let bits=url.split('/');while(bits.length){let st=bits.join('/');if(this.urls[st]){return this.urls[st].disabled?'':st;}
bits.pop();}}
if(this.def&&force){return this.def}
if(this.views.length&&force){return this.views[0].current}
return false;},setBaseURL(baseURL){while(baseURL.substr(-1)==='/'){baseURL=baseURL.substr(0,baseURL.length-1);}
while(baseURL.substr(0,1)==='/'){baseURL=baseURL.substr(1);}
return baseURL?baseURL+'/':'';},getDefaultView(){return{source:null,title:bbn._("Untitled"),options:null,cached:true,scrollable:true,component:null,icon:'',notext:false,content:null,menu:[],loaded:null,fcolor:null,bcolor:null,load:false,selected:null,css:'',advert:null,dirty:false,help:null,imessages:[],script:null,static:false,pinned:false,url:null,current:null,real:false,cfg:{},events:{},real:false,last:0};},route(url,force){if(!bbn.fn.isString(url)){bbn.fn.log("error in route with url",url);throw Error(bbn._('The component bbn-container must have a valid URL defined'));}
url=bbn.fn.replaceAll('//','/',url);if(this.ready&&(force||!this.activeContainer||(url!==this.currentURL))){let event=new CustomEvent("beforeRoute",{bubbles:false,cancelable:true});this.$emit("beforeRoute",event,url);if(!event.defaultPrevented){let bits=url.split('#');url=bits[0];if((url==='')&&this.hasEmptyURL){this.urls[''].setCurrent(url);this.realRoute('','',force);return;}
if(!url){let idx=this.getRoute('',true);if(idx){url=this.urls[idx].currentURL;}}
let st=url?this.getRoute(url):'';if(!url||(!force&&(this.currentURL===url))){if(bits[1]){}
return;}
else if(url&&((!st&&this.autoload)||(this.urls[st]&&this.urls[st].load&&!this.urls[st].isLoaded))){this.load(url);}
else{if(!st&&this.def&&(!url||force)){st=this.getRoute(this.def);if(st){url=this.def;}}
if(!st&&force&&this.views.length){st=this.views[0].url;if(st){url=this.urls[st].currentURL||st;}}
if(st){this.urls[st].setCurrent(url);this.realRoute(url,st,force,bits[1]);}}}}},realRoute(url,st,force,anchor){if(!bbn.fn.isString(url)&&!bbn.fn.isNumber(url)){bbn.fn.log("error in realRoute with url",url);throw Error(bbn._('The component bbn-container must have a valid URL defined'));}
if(this.urls[st]){if(url!==this.currentURL){this.currentURL=url;}
if(!this.routed){this.routed=true;this.$emit("route1",this);}
this.activate(url,this.urls[st]);if(this.urls[st]){this.urls[st].currentURL=url;this.urls[st].init();this.$nextTick(()=>{let child=this.urls[st].find('bbn-router');if(child){child.route(url.substr(st.length+1),force);}
else{let ifr=this.urls[st].find('bbn-frame');if(ifr){ifr.route(url.substr(st.length+1));}}});}}},next(force){let next=this.selected+1;if(!this.views[next]&&force){next=0;}
if(this.views[next]){this.activateIndex(next);}},prev(force){let prev=this.selected-1;if(!this.views[prev]&&force){prev=this.views.length-1;}
if(this.views[prev]){this.activateIndex(prev);}},activate(url,container){if(!bbn.fn.isString(url)){bbn.fn.log("error in activate with url",url);throw Error(bbn._('The component bbn-container must have a valid URL defined'));}
let todo=false;if(!this.activeContainer||(container&&(this.activeContainer!==container))){this.activeContainer=null;bbn.fn.each(this.$children,(cp)=>{if(bbn.fn.isFunction(cp.hide)){if((cp!==container)){cp.hide();}
else{cp.setCurrent(url);this.activeContainer=cp;}}});if(this.activeContainer){this.activeContainer.show();if(this.scrollable&&this.nav&&!this.breadcrumb){let scroll=this.getRef('horizontal-scroll');if(scroll.ready){this.getRef('horizontal-scroll').scrollTo(this.getRef('tab-'+this.activeContainer.idx));}
else if(scroll){scroll.$on('ready',()=>{setTimeout(()=>{this.getRef('horizontal-scroll').scrollTo(this.getRef('tab-'+this.activeContainer.idx));},100);})}}}}
else if(url!==this.activeContainer.currentURL){this.activeContainer.setCurrent(url);}},changeURL(url,title,replace){if(!bbn.fn.isString(url)){bbn.fn.log("error in changeURL with url",url);throw Error(bbn._('The component bbn-container must have a valid URL defined'));}
if(!bbn.env.isInit){return;}
if(title&&(title!==this.currentTitle)){this.currentTitle=title;}
if(url!==this.currentURL){this.currentURL=url;return;}
if(this.views[this.selected]&&((url.indexOf(this.views[this.selected].url+'/')===0)||(url===this.views[this.selected].url))){this.$set(this.views[this.selected],'current',url);}
if(this.urlNavigation){if(this.parentContainer){this.parentContainer.currentTitle=title+' < '+this.parentContainer.title;this.parent.changeURL(this.baseURL+url,this.parentContainer.currentTitle,replace);}
else if(replace||(url!==bbn.env.path)){if(!replace){}
if(!replace&&((this.getFullBaseURL()+url).indexOf(bbn.env.path)===0)){replace=true;}
bbn.fn.setNavigationVars(this.getFullBaseURL()+url,this.currentTitle,{},replace);}}},getBaseURL(){return this.baseURL;},getFullBaseURL(){return this.fullBaseURL;},getFullURL(){let url=this.getURL();if(url!==false){return this.getFullBaseURL()+url;}
return'';},getCurrentURL(){return this.currentURL;},getFullCurrentURL(){let url=this.getCurrentURL();if(url!==false){return this.getFullBaseURL()+url;}
return false;},parseURL(fullURL){let url=fullURL;if(fullURL===undefined){return'';}
if(!bbn.fn.isString(fullURL)){fullURL=fullURL.toString();}
if(fullURL.indexOf(bbn.env.root)===0){fullURL=fullURL.substr(bbn.env.root.length);}
fullURL=bbn.fn.removeTrailingChars(fullURL,'/');if(this.fullBaseURL===(fullURL+'/')){return'';}
if(this.fullBaseURL){if(fullURL.indexOf(this.fullBaseURL)===0){fullURL=fullURL.substr(this.fullBaseURL.length);}
else{fullURL='';}}
return fullURL;},isValidIndex(idx){return(typeof idx==='number')&&(this.views[idx]!==undefined);},activateDefault(){let idx=this.getIndex('',true);if(this.isValidIndex(idx)){this.activate(this.views[idx].current?this.views[idx].current:this.views[idx].url);}},activateIndex(idx){if(this.isValidIndex(idx)){if(this.urls[this.views[idx].url]){this.route(this.urls[this.views[idx].url].currentURL);}
else{this.route(this.views[idx].current);}}},getVue(idx){if(idx===undefined){idx=this.selected;}
if(this.isValidIndex(idx)){return this.urls[this.views[idx].url];}
return false;},getContainer(idx){if(idx===undefined){idx=this.selected;}
return this.urls[this.views[idx].url];},getDOMContainer(idx){if(idx===undefined){idx=this.selected;}
let c=this.getVue(idx);return c?c.$el:false;},getSubRouter(misc){let idx=this.getIndex(misc);if(idx===undefined){idx=this.selected;}
let container=this.getVue(idx);if(container){return container.find('bbn-router')||null;}
return null;},getRealVue(misc){let idx=this.getIndex(misc),router=this,sub=router;if(idx===undefined){idx=this.selected;}
while(router){router=sub.getSubRouter(idx);if(router){sub=router;idx=sub.selected;}}
return sub.getVue(idx);},getIndex(misc){if(!this.views.length){return false;}
if([undefined,null].includes(misc)){return this.selected;}
if(!this.isValidIndex(misc)){if(typeof(misc)==='string'){misc=this.search(misc);}
else if(typeof(misc)==='object'){if(misc.$el){misc=misc.$el;}
if(misc.tagName){bbn.fn.each(this.$children,(ct)=>{if(ct.$vnode&&ct.$vnode.componentOptions&&(ct.$vnode.componentOptions.tag==='bbn-container')&&((ct.$el===misc)||ct.$el.contains(misc))){misc=ct.currentIndex;return false;}});}}}
return this.isValidIndex(misc)?misc:false;},fixIndexes(){bbn.fn.each(this.views,(v,i)=>{if(v.idx!==i){v.idx=i;if(this.urls[v.url]){this.urls[v.url].currentIndex=i;}}});},remove(misc,force){let idx=this.getIndex(misc);if(idx>-1){let ev=new Event('close',{cancelable:!force}),ev2=new Event('beforeClose',{cancelable:!force});if(!force){this.$emit('beforeClose',idx,ev2);}
if(!ev2.defaultPrevented){if(!this.ignoreDirty&&this.isDirty&&this.views[idx].dirty&&!ev.defaultPrevented&&!force){ev.preventDefault();this.confirm(this.confirmLeave,()=>{let forms=this.urls[this.views[idx].url].findAll('bbn-form');if(Array.isArray(forms)&&forms.length){bbn.fn.each(forms,(f,k)=>{f.reset();});}
this.$nextTick(()=>{this.$emit('close',idx,ev);this.close(idx,true);});});}
else{if(this.views[idx].real){let url=this.views[idx].url;this.views.splice(idx,1);this.$delete(this.urls,url);this.fixIndexes()}
else{if(!force){this.$emit('close',idx,ev);}
if(force||!ev.defaultPrevented){let url=this.views[idx].url;this.views.splice(idx,1);this.$delete(this.urls,url);this.fixIndexes()}
return true;}}}}
return false;},add(obj,idx){let index;if((typeof(obj)==='object')&&bbn.fn.isString(obj.url)){obj.url=bbn.fn.replaceAll('//','/',obj.url);if(obj.$options){if(!obj.current&&!obj.currentURL){if(bbn.env.path.indexOf(this.getFullBaseURL()+(obj.url?obj.url+'/':''))===0){obj.currentURL=bbn.env.path.substr(this.getFullBaseURL().length);}
else{obj.currentURL=obj.url;}}
else{if(obj.currentURL){obj.currentURL=bbn.fn.replaceAll(obj.currentURL);}}
let obj2=bbn.fn.extend(true,{},obj.$options.propsData),props=obj.$options.props;bbn.fn.iterate(props,(v,i)=>{if(!(i in obj2)&&('default'in v)){obj2[i]=v.default;}});bbn.fn.iterate(this.getDefaultView(),(a,n)=>{if(obj2[n]===undefined){obj2[n]=a;}});if(!obj2.current){if(bbn.env.path.indexOf(this.getFullBaseURL()+(obj2.url?obj2.url+'/':''))===0){obj2.current=bbn.env.path.substr(this.getFullBaseURL().length);}
else{obj2.current=obj2.url;}}
else if((obj2.current!==obj2.url)&&(obj2.current.indexOf(obj2.url+'/')!==0)){obj2.current=obj2.url;}
if(!obj2.current){obj2.current=obj2.url;}
if(obj2.content){obj2.loaded=true;}
if(obj2.real&&!this.hasRealContainers){this.hasRealContainers=true;}
if(obj2.url===''){this.hasEmptyURL=true;}
if(this.search(obj2.url)===false){if(this.isValidIndex(idx)){this.views.splice(idx,0,obj2);}
else{this.views.push(obj2);}}}
else{if(!obj.current){if(bbn.env.path.indexOf(this.getFullBaseURL()+(obj.url?obj.url+'/':''))===0){obj.current=bbn.env.path.substr(this.getFullBaseURL().length);}
else{obj.current=obj.url;}}
else if((obj.current!==obj.url)&&(obj.current.indexOf(obj.url+'/')!==0)){obj.current=obj.url;}
if(!obj.current){obj.current=obj.url;}
if(obj.content){obj.loaded=true;}
obj.events={};if(obj.menu===undefined){obj.menu=[];}
index=this.search(obj.url);if(index!==false){let o=this.views[index],cn=this.urls[this.views[index].url];if(idx===undefined){idx=index;}
if(cn&&this.isValidIndex(idx)){cn.currentIndex=idx;}
if(obj.real){return;}
bbn.fn.iterate(obj,(a,n)=>{if(o[n]!==a){this.$set(o,n,a)}});}
else{let isValid=this.isValidIndex(idx);if(this.single){if(this.views.length){this.views.splice(0,this.views.length);}
obj.selected=true;obj.idx=this.views.length;}
else{obj.selected=false;obj.idx=isValid?idx:this.views.length;}
bbn.fn.iterate(this.getDefaultView(),(a,n)=>{if(obj[n]===undefined){this.$set(obj,n,a);}});if(isValid){this.views.splice(obj.idx,0,obj);}
else{this.views.push(obj);}}}
this.fixIndexes()}},search(url){if(!bbn.fn.isString(url)){bbn.fn.log("error in search with url",url);throw Error(bbn._('The component bbn-container must have a valid URL defined'));}
let r=bbn.fn.search(this.views,"url",url);if(r===-1){bbn.fn.each(this.views,(tab,index)=>{if(url.indexOf(tab.url+'/')===0){r=index;return false;}});}
return r>-1?r:false;},callRouter(url,st){if(!bbn.fn.isString(url)){bbn.fn.log("error in callRouter with url",url);throw Error(bbn._('The component bbn-container must have a valid URL defined'));}
if(this.parent){let containers=this.ancestors('bbn-container');url=this.getFullBaseURL().substr(this.router.baseURL.length)+url;this.router.realRoute(url,containers[containers.length-1].url,true);}
else{this.realRoute(url,st,true);}},searchContainer(url,deep){let container=false,idx=this.search(url);if(idx!==false){container=this.getContainer(idx);if(deep&&container){let router=container.find('bbn-router');if(router){let real=router.searchContainer(url.substr(router.baseURL.length),true);if(real){return real;}}}}
return container;},load(url,force){if(url){this.isLoading=true;let finalURL=this.fullBaseURL+url;let idx=this.search(url);let toAdd=false;let view;if(idx!==false){if(this.views[idx].loading||(!force&&!this.views[idx].load)){return;}
view=this.views[idx];if(force){toAdd=true;this.views.splice(idx,1);}}
else{toAdd=true;idx=this.views.length;}
if(toAdd){this.add({url:url,title:view&&view.title?view.title:bbn._('Loading'),load:true,loading:true,visible:true,real:false,scrollable:!this.single,current:url,error:false,loaded:false},idx);}
if(this.isBreadcrumb){this.selected=idx;}
this.$emit('update',this.views);let dataObj=this.postBaseUrl?{_bbn_baseURL:this.fullBaseURL}:{};return this.post(finalURL,dataObj,(d)=>{let callRealInit=true;this.isLoading=false;if(d.url){d.url=this.parseURL(d.url);}
if(!d.url){d.url=url;}
if(url.indexOf(d.url)===0){d.current=url;}
if(d.data&&bbn.fn.numProperties(d.data)){d.source=d.data;delete d.data;}
if((d.url!==d.current)&&this.urls[d.current]){this.remove(this.urls[d.current].idx,true);callRealInit=false;this.$on('registered',(url)=>{if(url===d.url){this.$off('registered',url);this.realInit(url);}})}
if(!d.title||(d.title===bbn._('Loading'))){if(view&&view.title){d.title=view.title;}
else{let title=bbn._('Untitled');let num=0;while(bbn.fn.search(this.views,{title:title})>-1){num++;title=bbn._('Untitled')+' '+num;}
d.title=title;}}
if(!d.current&&d.url){d.current=d.url;}
this.$nextTick(()=>{let o=bbn.fn.extend(view||{},d,{loading:false,load:true,real:false,loaded:true});this.add(o,idx);if(o.title){this.currentTitle=o.title;}
this.$nextTick(()=>{if(callRealInit){this.realInit(d.url);}})})},(xhr,textStatus,errorThrown)=>{this.isLoading=false;this.alert(textStatus);let idx=this.search(this.parseURL(finalURL));if(idx!==false){let url=this.views[idx].url;if(this.urls[url]){this.views.splice(this.urls[url].idx,1);}}
this.activate(url);},()=>{this.isLoading=false;});}},realInit(url){if(this.urls[url]){this.urls[url].setLoaded(true);this.urls[url].init();this.callRouter(this.urls[url].current,url);this.$emit('update',this.views);}
else{throw new Error(bbn._("Impossible to find the container for URL")+' '+url);}},reload(idx){this.$nextTick(()=>{if(this.views[idx]&&this.views[idx].load&&this.urls[this.views[idx].url]&&this.urls[this.views[idx].url].isLoaded){this.views[idx].loaded=false;if(this.views[idx].dirty){this.views[idx].dirty=false;}
this.urls[this.views[idx].url].isLoaded=false;this.$nextTick(()=>{this.route(this.urls[this.views[idx].url].currentURL,true);})}});},getDefaultURL(){if(this.url){return this.url;}
if(this.parentContainer&&(this.parentContainer.currentURL!==this.parentContainer.url)){return this.parentContainer.currentURL.substr(this.parentContainer.url.length+1);}
if(this.def){return this.def;}
return this.parseURL(bbn.env.path);},getTitle(idx){let cp=this,res='';if(idx===undefined){idx=this.selected;}
if(cp.views[idx]){res+=(cp.views[idx].title||bbn._('Untitled'));if(cp.parentTab){idx=cp.parentTab.idx;cp=cp.parentTab.router;while(cp){res+=' < '+(cp.views[idx].title||bbn._('Untitled'));if(cp.parentTab){idx=cp.parentTab.idx;cp=cp.parentTab.router;}
else{cp=false;}}}
res+=' - ';}
res+=bbn.env.siteTitle||bbn._("Untitled site")
return res;},retrieveDirtyContainers(){this.dirtyContainers.splice(0,this.dirtyContainers.length);bbn.fn.iterate(this.urls,(v)=>{if(v.dirty){this.dirtyContainers.push({idx:v.idx,url:v.url});}});},getMenuFn(idx){if(!this.nav||!this.views[idx]||(this.views[idx].menu===false)){return[];}
let items=[],tmp=((bbn.fn.isFunction(this.views[idx].menu)?this.views[idx].menu():this.views[idx].menu)||[]).slice(),others=false;bbn.fn.each(this.views,(a,i)=>{if((i!==idx)&&!a.static){others=true;return false;}});if(!this.views[idx].help){let sub=this.getSubRouter(idx);if(sub&&sub.views&&sub.views.length){let helps=[];sub.views.forEach((a)=>{if(a.help){helps.push({url:sub.fullBaseURL+a.url,content:a.help,title:a.title||a.url,anchor:bbn.fn.randomString(15,20).toLowerCase()});}});if(helps.length===1){this.views[idx].help=helps[0].content;}
else if(helps.length){this.views[idx].help='';let slide1='';helps.forEach((a)=>{slide1+='<h1><a href="#'+a.anchor+'">'+a.title+'</a></h1>\n';this.views[idx].help+='---slide---'+'\n<a name="'+a.anchor+'">\n'+a.content;});this.views[idx].help=slide1+this.views[idx].help;}}}
if(this.views[idx].help){items.push({text:bbn._("Help"),key:"help",icon:"nf nf-mdi-help_circle_outline",action:()=>{let view=this.getVue(idx),span=document.createElement('span');span.innerHTML=this.views[idx].title;let title=span.innerText;if(!title&&span.querySelector("[title]").length){title=span.querySelector("[title]").getAttribute("title");}
view.getPopup().open({scrollable:false,component:{props:['source'],template:`
                  <bbn-slideshow :source="source.content"
                                 class="bbn-bg-webblue bbn-white"
                                 separator="---slide---"></bbn-slideshow>`},source:{content:this.views[idx].help},title:'<i class="bbn-large nf nf-mdi-help_circle_outline"> </i> <span class="bbn-iblock">'+title+'</span>',width:'90%',height:'90%'});}})}
if(this.autoload){items.push({text:bbn._("Reload"),key:"reload",icon:"nf nf-mdi-sync",action:()=>{this.reload(idx);}});}
items.push({text:bbn._("Enlarge"),key:"enlarge",icon:"nf nf-mdi-arrow_expand_all",action:()=>{this.getVue(idx).fullScreen=true;}});if(tmp&&tmp.length){bbn.fn.each(tmp,(a,i)=>{items.push(a)})}
if(this.views[idx].icon&&this.views[idx].title&&!this.isBreadcrumb){items.push({text:this.views[idx].notext?bbn._("Show text"):bbn._("Show only icon"),key:"notext",icon:this.views[idx].notext?"nf nf-fa-font":"nf nf-fa-font_awesome",action:()=>{this.$set(this.views[idx],'notext',!this.views[idx].notext);}});}
if(!this.views[idx].static){if(this.isBreadcrumb){items.push({text:bbn._("Close"),key:"close",icon:"nf nf-mdi-close",action:()=>{this.close(idx);}});}
else{if(!this.views[idx].pinned){items.push({text:bbn._("Pin"),key:"pin",icon:"nf nf-mdi-pin",action:()=>{this.pin(idx);}});items.push({text:bbn._("Close"),key:"close",icon:"nf nf-mdi-close",action:()=>{this.close(idx);}})}
else{items.push({text:bbn._("Unpin"),key:"pin",icon:"nf nf-mdi-pin_off",action:()=>{this.unpin(idx);}});}}}
if(others){items.push({text:bbn._("Close Others"),key:"close_others",icon:"nf nf-mdi-close_circle_outline",action:()=>{this.closeAllBut(idx);}})}
if(others&&!this.views[idx].static){items.push({text:bbn._("Close All"),key:"close_all",icon:"nf nf-mdi-close_circle",action:()=>{this.closeAll();}})}
let menu=bbn.fn.isArray(this.menu)?this.menu:this.menu(this.views[idx],this);if(menu.length){bbn.fn.each(menu,a=>{items.push(a);});}
items.push({text:bbn._('Switch to ')+(this.isBreadcrumb?bbn._('tabs'):bbn._('breadcrumb'))+' '+bbn._('mode'),key:'switch',icon:this.isBreadcrumb?'nf nf-mdi-tab':'nf nf-fa-ellipsis_h',action:()=>{this.itsMaster.isBreadcrumb=!this.itsMaster.isBreadcrumb;}});return items;},close(idx,force){let res=this.remove(idx,force);if(res&&(this.selected>idx)){this.selected--;}
else if(res&&(this.selected===idx)){this.selected=false;if(this.views.length){bbn.fn.each(this.history,(a)=>{let tmp=this.getIndex(a);if(tmp!==false){idx=tmp;return false;}});this.activateIndex(this.views[idx]?idx:idx-1);}}
this.$nextTick(()=>{this.setConfig();})
return res;},setConfig(){if(this.autoload&&this.isInit){this.setStorage(this.getConfig(),this.parentContainer?this.parentContainer.getFullURL():this.storageName);}},getConfig(){let cfg={baseURL:this.parentContainer?this.parentContainer.getFullURL():this.storageName,views:[],breadcrumb:this.isBreadcrumb};bbn.fn.each(this.views,(obj,i)=>{if(obj.url&&obj.load){let res={url:obj.url,icon:obj.icon||false,notext:obj.notext||false,load:true,loaded:false,title:obj.title?obj.title:bbn._('Untitled'),static:!!obj.static,pinned:!!obj.pinned,current:obj.current?obj.current:obj.url,cfg:{},real:obj.real,last:obj.last};if(obj.bcolor){res.bcolor=obj.bcolor;}
if(obj.fcolor){res.fcolor=obj.fcolor;}
cfg.views.push(res);}});return cfg;},unsetConfig(){if(this.autoload){this.unsetStorage(this.parentContainer?this.parentContainer.getFullURL():this.storageName);}},observerEmit(newVal,obs){if(bbn.vue.observerComponent.methods.observerEmit.apply(this,[newVal,obs])){let ele=this.$el.querySelector(".bbn-observer-"+obs.element);if(ele){let idx=this.getIndex(ele);if(idx!==false){this.$set(this.views[idx].events,'bbnObs'+obs.element+obs.id,newVal);this.$nextTick(()=>{});}}}},observerClear(obs){let ele=this.$el.querySelector(".bbn-observer-"+obs.element);if(ele){let idx=this.getIndex(ele);if((idx!==false)&&(this.views[idx].events['bbnObs'+obs.element+obs.id]!==undefined)){this.$delete(this.views[idx].events,'bbnObs'+obs.element+obs.id);this.$nextTick(()=>{});}}
else if(this.observationTower){this.observationTower.observerClear(obs);}},enter(container){},containerComponentMount(){let ct=this.getRef('container');ct.init();this.$nextTick(()=>{ct.show();})},cutTitle(title){return bbn.fn.shorten(title,this.maxTitleLength)},getFullTitle(obj){let t='';if(obj.notext||(obj.title.length>this.maxTitleLength)){t+=obj.title;}
if(obj.ftitle){t+=(t.length?' - ':'')+obj.ftitle;}
return t||null;},getFontColor(idx){if(bbn.fn.isNumber(idx)){if(this.views[idx]&&this.views[idx].fcolor){return this.views[idx].fcolor;}
let el=this.getRef('title-'+idx);if(el){return window.getComputedStyle(el.$el?el.$el:el).color;}}
return'';},getBackgroundColor(idx){if(bbn.fn.isNumber(idx)){if(this.views[idx]&&this.views[idx].bcolor){return this.views[idx].bcolor;}
let el=this.getRef('title-'+idx);if(el){return window.getComputedStyle(el.$el?el.$el:el).backgroundColor;}}
return'';},scrollTabs(dir){let scroll=this.getRef('horizontal-scroll');if(scroll){if(dir==='right'){scroll.scrollAfter();}
else{scroll.scrollBefore();}}},getTab(idx){if(idx===undefined){idx=this.selected;}
return this.getRef('tab-'+idx);},closeAll(){for(let i=this.views.length-1;i>=0;i--){if(!this.views[i].static&&!this.views[i].pinned){this.close(i);}}},closeAllBut(idx){for(let i=this.views.length-1;i>=0;i--){if(!this.views[i].static&&!this.views[i].pinned&&(i!==idx)){this.close(i);}}},pin(idx){if(this.isValidIndex(idx)){let ev=new CustomEvent('beforePin',{cancelable:true});this.$emit('beforePin',idx,ev);if(!ev.defaultPrevented){this.views[idx].pinned=true;this.setConfig();this.$emit('pin',idx);}}},unpin(idx){if(this.isValidIndex(idx)){let ev=new CustomEvent('beforeUnpin',{cancelable:true});this.$emit('beforeUnpin',idx,ev);if(!ev.defaultPrevented){this.views[idx].pinned=false;this.setConfig();this.$emit('unpin',idx);}}},registerBreadcrumb(bc){let url=bc.baseURL.substr(0,bc.baseURL.length-1);this.breadcrumbsList.push(bc);if(this.itsMaster&&!this.master){this.itsMaster.breadcrumbsList.push(bc);}},unregisterBreadcrumb(bc){let url=bc.baseURL.substr(0,bc.baseURL.length-1);let idx=bbn.fn.search(this.breadcrumbsList,{baseURL:bc.baseURL});if(idx!==-1){this.breadcrumbsList.splice(idx,1);}
if(this.itsMaster&&!this.master){idx=bbn.fn.search(this.itsMaster.breadcrumbsList,{baseURL:bc.baseURL});if(idx!==-1){this.itsMaster.breadcrumbsList.splice(idx,1);}}},getBreadcrumbs(idx){let ret=[];if(bbn.fn.isNumber(idx)&&this.views[idx]){let url=this.views[idx].url,bc=bbn.fn.getRow(this.breadcrumbsList,{baseURL:url+'/'});if(this.urls[url]&&bc){ret.push(...bc.breadcrumbs);}}
return ret;},getList(idx){let list=[],parents=bbn.fn.map(idx&&this.itsMaster&&(this.baseURL!==this.itsMaster.baseURL)?this.getParents():[],p=>{return{view:p.views[p.selected],maxTitleLength:p.maxTitleLength}});if(parents.length>idx){parents.splice(0,parents.length-idx);}
bbn.fn.each(this.views,(t,i)=>{if(!t.hidden&&(t.idx!==this.selected)){list.push({view:t,key:t.url,parents:parents,children:bbn.fn.map(this.getBreadcrumbs(i),c=>{return{view:c.views[c.selected],maxTitleLength:c.maxTitleLength}}),maxTitleLength:this.maxTitleLength,action:()=>{this.activateIndex(t.idx);},closeAction:()=>{return this.close(t.idx)}})}});return list;},getParents(){return this.parent?[...this.parent.getParents(),this.parent]:[]},openMenu(ev){let ele=ev.target.parentElement.parentElement,e=new MouseEvent("contextmenu",{bubbles:true,cancelable:true,view:window});ele.dispatchEvent(e);}},created(){this.componentClass.push('bbn-resize-emitter');this.$on('route',url=>{if(this.nav){this.setConfig();let i=this.history.indexOf(url);if(i>-1){this.history.splice(i,1);}
this.history.unshift(url);while(this.history.length>this.historyMaxLength){this.history.pop();}}});},mounted(){this.parents=this.ancestors('bbn-router');this.parent=this.parents.length?this.parents[0]:false;this.router=this.parents.length?this.parents[this.parents.length-1]:this;if(this.parent){this.parentContainer=this.closest('bbn-container');let uri=this.parentContainer.url;if(this.root&&(uri!==this.root)&&(uri.indexOf(this.root)===0)){uri=this.root;}
this.baseURL=this.setBaseURL(uri);}
else{window.addEventListener("beforeunload",e=>{e=e||window.event;if(this.isDirty){let st=bbn._('You have unsaved data, are you sure you want to leave?');if(e){e.returnValue=st;}
return st;}});}
let tmp=[];if(this.$slots.default){for(let node of this.$slots.default){if(node.componentOptions&&(node.componentOptions.tag==='bbn-container')){if(node.componentOptions.propsData.url===undefined){throw new Error(bbn._("You cannot use containers in router without defining a URL property"));}
if(!this.hasRealContainers){this.hasRealContainers=true;}
if(node.componentOptions.propsData.url===''){this.hasEmptyURL=true;}
let obj=bbn.fn.extend(true,{},node.componentOptions.propsData),props=node.componentOptions.Ctor.options.props;bbn.fn.iterate(props,(v,i)=>{if(!(i in obj)&&('default'in v)){obj[i]=v.default;}});bbn.fn.iterate(this.getDefaultView(),(a,n)=>{if(obj[n]===undefined){obj[n]=a;}});obj.real=true;tmp.push(obj);}}}
bbn.fn.each(this.source,(a)=>{if(a.url===''){if(a.load){throw new Error(bbn._("You cannot use containers with empty URL for loading"));}
this.hasEmptyURL=true;}
tmp.push(bbn.fn.extendOut(a,{real:false}));});let storage=this.getStorage(this.parentContainer?this.parentContainer.getFullURL():this.storageName);if(storage){if(storage.breadcrumb!==undefined){this.isBreadcrumb=storage.breadcrumb;}
if(storage.views){bbn.fn.each(storage.views,(a)=>{let idx=bbn.fn.search(tmp,{url:a.url});if(idx>-1){bbn.fn.extend(tmp[idx],a);}
else{tmp.push(a);}});}}
let url=this.getDefaultURL();bbn.fn.each(tmp,(a)=>{if(!bbn.fn.isString(a.url)){throw new Error(bbn._("The container must have a valid URL"));}
if(url&&url.indexOf(a.url)===0){a.current=url;}
this.add(a);});if(!this.master&&this.parent){this.parent.registerBreadcrumb(this);let ct=this.closest('bbn-container');ct.$on('view',()=>{this.parent.registerBreadcrumb(this);});ct.$on('unview',()=>{this.parent.unregisterBreadcrumb(this);});if(ct.visible){this.parent.registerBreadcrumb(this);}}
this.ready=true;setTimeout(()=>{this.iconsReady=true;},1000);},beforeDestroy(){if(!this.master&&this.parent){this.parent.unregisterBreadcrumb(this);}},watch:{currentTitle(v){if(!this.parent){document.title=v+' - '+bbn.env.siteTitle;}},currentURL(newVal,oldVal){if(this.ready){if(!this.disabled){this.$nextTick(()=>{if(this.activeContainer){this.changeURL(newVal,this.activeContainer.title);}
else if(this.isLoading){this.changeURL(newVal,bbn._("Loading"));}
let idx=this.search(newVal);if((idx!==false)&&(this.selected!==idx)){this.selected=idx;this.views[this.selected].last=bbn.fn.timestamp();}
this.$emit('change',newVal);});}
this.$emit('route',newVal);}},url(newVal){if(this.ready){this.route(newVal);}},isDirty(v){if(this.parentContainer){this.parentContainer.dirty=v;}},itsMaster(newVal,oldVal){if(this.nav&&(newVal!==oldVal)){this.isBreadcrumb=newVal?newVal.isBreadcrumb:this.breadcrumb;if(this.breadcrumbWatcher){this.breadcrumbWatcher();}
if(newVal){this.breadcrumbWatcher=this.$watch('itsMaster.isBreadcrumb',isB=>{this.isBreadcrumb=isB;});}}},isBreadcrumb(newVal){this.$nextTick(()=>{this.setConfig();})}},components:{listItem:{template:`
<div class="bbn-w-100 bbn-vmiddle bbn-bordered-bottom"
     style="height: 2.5em"
     @mouseenter="isHover = true"
     @mouseleave="isHover = false">
  <div class="bbn-flex-width bbn-vmiddle bbn-h-100">
    <div class="bbn-vmiddle bbn-h-100">
      <div v-for="(p, i) in source.parents"
           class="bbn-vmiddle bbn-h-100">
        <div class="bbn-vmiddle bbn-h-100"
            :style="{
              backgroundColor: !isHover && p.view.bcolor ? p.view.bcolor : null,
              color: !isHover && p.view.fcolor ? p.view.fcolor : null
            }">
          <div class="bbn-router-breadcrumb-badge-container bbn-middle"
              v-if="numProperties(p.view.events)">
            <span class="bbn-badge bbn-small bbn-bg-red"
                  v-text="numProperties(p.view.events)"/>
          </div>
          <div class="bbn-router-breadcrumb-loader bbn-border-text"
              :style="{borderColor: p.view.fcolor || null}"
              v-show="p.view.loading"/>
          <div :class="['bbn-router-breadcrumb-element', 'bbn-h-100', 'bbn-vmiddle', {'bbn-router-breadcrumb-dirty': p.view.dirty}]">
            <span v-if="p.view.icon"
                  :title="p.view.title"
                  :class="'bbn-router-breadcrumb-element-icon bbn-h-100 bbn-vmiddle bbn-right-xsspace' + (p.view.notext ? ' bbn-lg' : ' bbn-m')">
              <i :class="p.view.icon"
                style="zoom: 1.1"/>
            </span>
            <span v-if="!p.view.notext"
                  class="bbn-router-breadcrumb-element-text"
                  :title="p.view.title && (p.view.title.length > p.maxTitleLength) ? p.view.title : ''"
                  v-html="p.view.title ? shortTitle(p) : '`+bbn._('Untitled')+`'"/>
          </div>
        </div>
        <div>
          <i class="nf nf-fa-angle_right bbn-hsmargin bbn-large bbn-router-breadcrumb-arrow"/>
        </div>
      </div>

      <div class="bbn-vmiddle bbn-h-100"
          :style="{
            backgroundColor: !isHover && source.view.bcolor ? source.view.bcolor : null,
            color: !isHover && source.view.fcolor ? source.view.fcolor : null
          }">
        <div class="bbn-router-breadcrumb-badge-container bbn-middle"
             v-if="numProperties(source.view.events)">
          <span class="bbn-badge bbn-small bbn-bg-red"
                v-text="numProperties(source.view.events)"/>
        </div>
        <div class="bbn-router-breadcrumb-loader bbn-border-text"
             :style="{borderColor: source.view.fcolor || null}"
             v-show="source.view.loading"/>
        <div :class="['bbn-router-breadcrumb-element', 'bbn-h-100', 'bbn-vmiddle', {'bbn-router-breadcrumb-dirty': source.view.dirty}]">
          <span v-if="source.view.icon"
                :title="source.view.title"
                :class="'bbn-router-breadcrumb-element-icon bbn-h-100 bbn-vmiddle bbn-right-xsspace' + (source.view.notext ? ' bbn-lg' : ' bbn-m')">
            <i :class="source.view.icon"
               style="zoom: 1.1"/>
          </span>
          <span v-if="!source.view.notext"
                class="bbn-router-breadcrumb-element-text"
                :title="source.view.title && (source.view.title.length > source.maxTitleLength) ? source.view.title : ''"
                v-html="source.view.title ? (source.parents.length? shortTitle(source): source.view.title) : '`+bbn._('Untitled')+`'"/>
        </div>
      </div>

      <div v-for="(p, i) in source.children"
           class="bbn-vmiddle bbn-h-100">
        <div>
          <i class="nf nf-fa-angle_right bbn-hsmargin bbn-large bbn-router-breadcrumb-arrow"/>
        </div>
        <div class="bbn-vmiddle bbn-h-100"
             :style="{
               backgroundColor: !isHover && p.view.bcolor ? p.view.bcolor : null,
               color: !isHover && p.view.fcolor ? p.view.fcolor : null
             }">
          <div class="bbn-router-breadcrumb-badge-container bbn-middle"
              v-if="numProperties(p.view.events)">
            <span class="bbn-badge bbn-small bbn-bg-red"
                  v-text="numProperties(p.view.events)"/>
          </div>
          <div class="bbn-router-breadcrumb-loader bbn-border-text"
              :style="{borderColor: p.view.fcolor || null}"
              v-show="p.view.loading"/>
          <div :class="['bbn-router-breadcrumb-element', 'bbn-h-100', 'bbn-vmiddle', {'bbn-router-breadcrumb-dirty': p.view.dirty}]">
            <span v-if="p.view.icon"
                  :title="p.view.title"
                  :class="'bbn-router-breadcrumb-element-icon bbn-h-100 bbn-vmiddle bbn-right-xsspace' + (p.view.notext ? ' bbn-lg' : ' bbn-m')">
              <i :class="p.view.icon"
                style="zoom: 1.1"/>
            </span>
            <span v-if="!p.view.notext"
                  class="bbn-router-breadcrumb-element-text"
                  :title="p.view.title && (p.view.title.length > p.maxTitleLength) ? p.view.title : ''"
                  v-html="p.view.title ? shortTitle(p) : '`+bbn._('Untitled')+`'"/>
             </div>
        </div>
      </div>
    </div>
    <div class="bbn-flex-fill bbn-h-100"
         :style="!isHover ? lastColors : {}">
      &nbsp;
    </div>
    <div v-if="!source.view.static"
          class="bbn-vmiddle bbn-h-100 bbn-hpadded"
          @click.prevent.stop="close"
          :style="!isHover ? lastColors : {}">
      <i class="nf nf-fa-times_rectangle bbn-lg"/>
    </div>
  </div>
</div>
        `,props:{source:{type:Object,required:true}},data(){return{isHover:false}},computed:{lastColors(){let e=this.source.children.length?this.source.children[this.source.children.length-1].view:this.source.view;let r={};if(e.bcolor){r.backgroundColor=e.bcolor;}
if(e.fcolor){r.color=e.fcolor;}
return r;}},methods:{numProperties:bbn.fn.numProperties,close(){let k=this.source.key;if(this.source.closeAction()){let list=this.closest('bbn-list');if(bbn.fn.isVue(list)){let idx=bbn.fn.search(list.source,{'data.key':k});if(idx>-1){list.source.splice(idx,1);if(list.source.length){list.updateData();this.$nextTick(()=>{list.closest('bbn-floater').onResize(true);})}
else{this.closest('bbn-floater').close();}}}}},shortTitle(src){return src.view.title.length>src.maxTitleLength?bbn.fn.shorten(src.view.title,src.maxTitleLength):src.view.title;}}}}});})(bbn,Vue);if(bbn_resolve){bbn_resolve("ok");}})(bbn);}