(bbn_resolve)=>{((bbn)=>{let script=document.createElement('script');script.innerHTML=`<div :class="[componentClass, 'bbn-w-100']"
     v-show="ready"
>
  <div v-if="showLoading && isLoading"
       class="bbn-overlay bbn-middle bbn-xl bbn-white bbn-modal bbn-abs"
       v-text="_('Loading')"
       style="z-index: 1"
  ></div>
  <div :class="['bbn-widget', 'bbn-flex-height', {'bbn-overlay': type === 'weeks'}]">
    <div class="bbn-calendar-header bbn-header bbn-xspadded bbn-no-border-left bbn-no-border-right bbn-no-border-top">
      <component v-if="headerComponent"
                 :is="headerComponent"
      ></component>
      <div v-else
           class="bbn-flex-width bbn-vmiddle"
      >
        <template v-if="arrows && arrowsButtons">
          <bbn-button v-if="currentCfg.stepSkip"
                      icon="nf nf-fa-angle_double_left"
                      @click="prev(true)"
                      :title="_('Previous') + ' ' + currentCfg.stepSkipText"
                      :notext="true"
                      class="bbn-right-xsspace"
          ></bbn-button>
          <bbn-button icon="nf nf-fa-angle_left"
                      @click="prev(false)"
                      :title="_('Previous') + ' ' + currentCfg.stepText"
                      :notext="true"
          ></bbn-button>
        </template>
        <template v-else-if="arrows && !arrowsButtons">
          <i v-if="currentCfg.stepSkip"
             class="nf nf-fa-angle_double_left bbn-p bbn-hsmargin"
             @click="prev(true)"
             :title="_('Previous') + ' ' + currentCfg.stepSkipText"
          ></i>
          <i class="nf nf-fa-angle_left bbn-p bbn-hsmargin"
             @click="prev(false)"
             :title="_('Previous') + ' ' + currentCfg.stepText"
          ></i>
        </template>
        <div class="bbn-flex-fill bbn-middle bbn-calendar-header-title">
          <span @click="!!titleAction ? titleAction(_self) : false"
                :class="{'bbn-p': !!titleAction}"
          >
            <i v-if="titleIcon"
               :class="[titleIcon, 'bbn-hsmargin', 'bbn-large']"></i>
            <strong v-text="title"></strong>
          </span>
        </div>
        <template v-if="arrows && arrowsButtons">
          <bbn-button icon="nf nf-fa-angle_right"
                      @click="next(false)"
                      :title="_('Next') + ' ' + currentCfg.stepText"
                      :notext="true"
          ></bbn-button>
          <bbn-button v-if="currentCfg.stepSkip"
                      icon="nf nf-fa-angle_double_right"
                      @click="next(true)"
                      :title="_('Next') + ' ' + currentCfg.stepSkipText"
                      :notext="true"
                      class="bbn-left-xsspace"
          ></bbn-button>
        </template>
        <template v-else-if="arrows && !arrowsButtons">
          <i class="nf nf-fa-angle_right bbn-p bbn-hsmargin"
             @click="next(false)"
             :title="_('Next') + ' ' + currentCfg.stepText"
          ></i>
          <i v-if="currentCfg.stepSkip"
             class="nf nf-fa-angle_double_right bbn-p bbn-hsmargin"
             @click="next(true)"
             :title="_('Next') + ' ' + currentCfg.stepSkipText"
          ></i>
        </template>
      </div>
    </div>
    <div class="bbn-flex-fill bbn-spadded"
         style="display: flex;"
    >
      <div class="bbn-calendar-container bbn-w-100"
           :style="gridStyle"
      >
        <div class="bbn-calendar-labels"
            v-if="labels && currentLabels"
            v-for="(label, i) in currentLabels"
            v-html="label"
            ref="label"
        ></div>
        <template v-for="item in items">
          <div v-if="!item.hidden"
              :class="['bbn-calendar-item-box', 'bbn-box', {
                'bbn-p': selection && !item.disabled,
                'bbn-spadded': !itemDetails && itemPadding,
                'bbn-tertiary': item.isCurrent && !(selection && (item.value === currentValue)),
                'bbn-background-effect-tertiary': item.isCurrent && item.inRange && (item.value !== currentValue),
                'bbn-background-effect-primary': item.inRange && (item.value === currentValue),
                'bbn-state-hover': selection && item.over && !item.disabled,
                'bbn-background-effect-hover': selection && item.over && !item.disabled && item.inRange,
                'bbn-primary': selection && (item.value === currentValue),
                'bbn-secondary': item.colored && !item.hidden && !item.extra,
                'bbn-background-effect-secondary': item.colored && !item.hidden && !item.extra && item.inRange && (item.value !== currentValue),
                'bbn-alt-background-effect': !item.hidden && item.inRange && !item.isCurrent,
                'bbn-active-background': !item.hidden && item.inRange && !item.isCurrent && (item.value !== currentValue) && !item.colored && (!item.over || (item.over && item.disabled)),
                'bbn-disabled': item.disabled,
                'bbn-alt-background': extraItems && item.extra
              }]"
              @mouseover="item.over = true"
              @mouseleave="item.over = false"
              @click="!item.disabled ? select(item.value) : false"
              :title="typeof itemTitle === 'function' ? itemTitle(item) : itemTitle"
          >
            <div v-if="item.events && item.events.length && itemDetails"
                class="bbn-flex-height"
                style="position: relative"
            >
              <div :class="['bbn-r', 'bbn-unselectable', 'bbn-calendar-item', {
                'bbn-secondary-text': item.colored && !item.hidden && !item.extra,
                'bbn-tertiary-text': item.isCurrent && (!item.inRange || (item.inRange && item.over))
              }]"
                  style="margin-right: .2em"
              >
                <span v-text="item.text"></span>
              </div>
              <component v-if="itemComponent"
                        :is="itemComponent"
                        :source="item"
                        :selected="currentValue"
                        class="bbn-flex-fill"
              ></component>
            </div>
            <template v-else>
              <i v-if="item.events && item.events.length && eventIcon"
                :class="[eventIcon, 'bbn-unselectable', 'bbn-calendar-item-icon']"
              ></i>
              <div :class="['bbn-100', 'bbn-middle', 'bbn-unselectable', 'bbn-calendar-item', {'bbn-tertiary-text': item.colored && !item.extra}]">
                <span v-text="item.text"></span>
              </div>
            </template>
          </div>
          <div v-else class="bbn-calendar-item-box bbn-box bbn-o bbn-alt-background"></div>
        </template>
      </div>
    </div>
  </div>
</div>`;script.setAttribute('id','bbn-tpl-component-calendar');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);let css=document.createElement('link');css.setAttribute('rel',"stylesheet");css.setAttribute('href',bbn.vue.libURL+"dist/js/components/calendar/calendar.css");document.head.insertAdjacentElement('beforeend',css);((bbn)=>{"use strict";Vue.component('bbn-calendar',{mixins:[bbn.vue.basicComponent,bbn.vue.listComponent,bbn.vue.resizerComponent],props:{autobind:{type:Boolean,default:false},source:{type:[String,Array],default(){return[];}},type:{type:String,default:'days',validator:(m)=>['days','weeks','months','years'].includes(m)},autoSelection:{type:Boolean,default:false},multiSelection:{type:Boolean,default:false},value:{type:String,default:''},arrows:{type:Boolean,default:true},arrowsButtons:{type:Boolean,default:true},titleIcon:{type:[String,Boolean],default:'nf nf-oct-calendar'},titleAction:{type:Function},date:{type:String},extraItems:{type:Boolean,default:false},itemsRange:{type:Array,default(){return[];}},onlyEvents:{type:Boolean,default:false},disableNoEvents:{type:Boolean,default:false},itemDetails:{type:Boolean,default:false},eventIcon:{type:[String,Boolean],default:'nf nf-fa-calendar'},itemPadding:{type:Boolean,default:false},itemComponent:{type:[Vue,Object,String]},itemTitle:{type:[Function,String],default:''},headerComponent:{type:[Vue,Object,String]},labels:{type:[String,Boolean],default:'auto',validator:(s)=>['auto','letter','abbr','full',false].includes(s)},startField:{type:String,default:'start'},endField:{type:String,default:'end'},startFormat:{type:String,default:'YYYY-MM-DD 00:00:00'},endFormat:{type:String,default:'YYYY-MM-DD 23:59:59'},max:{type:String},min:{type:String},disableDates:{type:[Array,Function],default(){return[];}},showLoading:{type:Boolean,default:false}},data(){let mom=dayjs();if(this.date){let m=dayjs(this.date,this.getCfg().valueFormat);mom=m.isValid()?m:mom;}
else if(this.max){let m=dayjs(this.max,this.getCfg().valueFormat);mom=m.isValid()?m:mom;}
return{today:dayjs().format('YYYY-MM-DD'),title:'',currentLabels:[],currentLabelsDates:[],currentDate:mom,items:[],ready:false,gridStyle:'',currentValue:'',events:{}}},computed:{currentCfg(){if(this.type){return this.getCfg();}
return{}}},methods:{_makeItem(txt,val,hid,col,dis,ext){let events=this.events[val],obj={text:txt,value:val,isCurrent:val===dayjs(this.today,this.currentCfg.valueFormat).format(this.currentCfg.valueFormat),hidden:!!hid,colored:!!col,over:false,events:events,inRange:this.itemsRange.includes(val),disabled:!!dis,extra:!!ext};if((this.onlyEvents&&(!events||!events.length))||(this.min&&(obj.value<dayjs(this.min,this.currentCfg.valueFormat).format(this.currentCfg.valueFormat)))||(this.max&&(obj.value>dayjs(this.max,this.currentCfg.valueFormat).format(this.currentCfg.valueFormat)))){obj.hidden=true;}
if(this.disableDates){obj.disabled=bbn.fn.isFunction(this.disableDates)?this.disableDates(obj.value):this.disableDates.includes(obj.value);}
if(this.disableNoEvents&&!obj.disabled){obj.disabled=!events||!events.length;}
return obj;},_makeDays(){let items=[],c=dayjs(this.currentDate.format('YYYY-MM-01')),currentMonth=this.currentDate.month(),sunday=dayjs(c).day('Sunday').weekday();for(let i=1;i<=6;i++){if(i>1){c=c.add(1,'w');}
items=items.concat(Array.from({length:7},(v,k)=>{let w=dayjs(c).weekday(k),val=w.format(this.currentCfg.valueFormat),otherMonth=dayjs(w).month()!==currentMonth,isHidden=!this.extraItems&&!!otherMonth?true:false;return this._makeItem(w.get('date'),val,isHidden,k===sunday,false,this.extraItems&&!!otherMonth);}));}
this.gridStyle='grid-template-columns: repeat(7, 1fr); grid-template-rows: max-content repeat(6, 1fr);';this.currentLabelsDates=Array.from({length:7},(v,i)=>dayjs(this.currentDate).weekday(i));this.$set(this,'items',items);},_makeWeeks(){let c=dayjs(this.currentDate),sunday=dayjs(c).day('Sunday').weekday(),items=Array.from({length:7},(v,k)=>{let w=c.weekday(k);return this._makeItem(w.get('date'),w.format(this.currentCfg.valueFormat),false,k===sunday,false,false);});this.gridStyle='grid-template-columns: repeat(7, 1fr); grid-template-rows: max-content auto';this.currentLabelsDates=Array.from({length:7},(v,i)=>dayjs(this.currentDate).weekday(i));this.$set(this,'items',items);},_makeMonths(){let c=dayjs(this.currentDate.format('YYYY-01-01')),items=Array.from({length:12},(v,k)=>{let w=c.month(k);return this._makeItem(w.format('MMM'),w.format(this.currentCfg.valueFormat),!this.extraItems&&(w.get('year')!==this.currentDate.get('year')),false,false,this.extraItems&&(w.get('year')!==this.currentDate.get('year')));});this.gridStyle='grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(4, 1fr);';this.currentLabelsDates=[];this.$set(this,'items',items);},_makeYears(){let c=dayjs(this.currentDate.format('YYYY-01-01')),year=c.format('YYYY'),items=Array.from({length:12},(v,k)=>{let w=c.year(year-6+k);return this._makeItem(w.format('YYYY'),w.format(this.currentCfg.valueFormat),false,false,k===0||k===11,false);});this.gridStyle='grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(4, 1fr);';this.currentLabelsDates=[];this.$set(this,'items',items);},getCfg(type){let m=type||this.type,cfg={};switch(m){case'days':bbn.fn.extend(cfg,{make:this._makeDays,step:[1,'M'],stepSkip:[1,'y'],stepEvent:[1,'d'],stepText:bbn._('month'),stepSkipText:bbn._('year'),titleFormat:'MMM YYYY',valueFormat:'YYYY-MM-DD',labelsFormatDefault:'ddd',labelsFormatLetter:'dd',labelsFormatAbbr:'ddd',labelsFormatFull:'dddd',startFormat:'YYYY-MM-01',endFormat:()=>{return'YYYY-MM-'+this.currentDate.daysInMonth()},startExtra:[7,'d'],endExtra:[15,'d']});break;case'weeks':bbn.fn.extend(cfg,{make:this._makeWeeks,step:[1,'w'],stepEvent:[1,'w'],stepText:bbn._('week'),titleFormat:'MMM YYYY',valueFormat:'YYYY-MM-DD',labelsFormatDefault:'ddd',labelsFormatLetter:'dd',labelsFormatAbbr:'ddd',labelsFormatFull:'dddd',startFormat:()=>{return dayjs(this.currentDate).weekday(0).format('YYYY-MM-DD');},endFormat:()=>{return dayjs(this.currentDate).weekday(6).format('YYYY-MM-DD');}});break;case'months':bbn.fn.extend(cfg,{make:this._makeMonths,step:[1,'y'],stepEvent:[1,'M'],stepText:bbn._('year'),titleFormat:'YYYY',valueFormat:'YYYY-MM',startFormat:'YYYY-01-01',endFormat:'YYYY-12-31'});break;case'years':bbn.fn.extend(cfg,{make:this._makeYears,step:[10,'y'],stepEvent:[1,'y'],stepText:bbn._('decade'),titleFormat:()=>{let from=this.currentDate.format('YYYY')-5,to=from+9;return from+'-'+to;},valueFormat:'YYYY',startFormat:()=>{return(this.currentDate.format('YYYY')-5)+'-01-01';},endFormat:()=>{return(this.currentDate.format('YYYY')+4)+'-12-31';}});break;}
return cfg;},getLabelsFormat(){if(this.labels){switch(this.labels){case'letter':return this.currentCfg.labelsFormatLetter;case'abbr':return this.currentCfg.labelsFormatAbbr;case'full':return this.currentCfg.labelsFormatFull;default:if(this.$refs.label&&this.$refs.label[0]){let w=this.$refs.label[0].offsetWidth;if(w<40){return this.currentCfg.labelsFormatLetter;}
else if(w<100){return this.currentCfg.labelsFormatAbbr;}
else{return this.currentCfg.labelsFormatFull;}}
return this.currentCfg.labelsFormatDefault;}}
return false;},create(){if(!this.ready){this.$once('dataloaded',()=>{this.init();this.$nextTick(()=>{if(!this.date&&(this.max||this.min)){if(this.max&&!this.min&&(this.max<this.currentDate.format(this.currentCfg.valueFormat))){this.currentDate=dayjs(this.max,this.currentCfg.valueFormat);}
if(this.min&&!this.max&&(this.min>this.currentDate.format(this.currentCfg.valueFormat))){this.currentDate=dayjs(this.min,this.currentCfg.valueFormat);}
this.currentCfg.make();this.setTitle();}
this.ready=true;});});this.updateData();}},makeEvents(){this.$set(this,'events',{});bbn.fn.each(this.currentData,d=>{let tmpStart=dayjs(d.data[this.startField],this.startFormat).format(this.currentCfg.valueFormat),tmpEnd=dayjs(d.data[this.endField],this.endFormat).format(this.currentCfg.valueFormat);if(this.events[tmpStart]===undefined){this.events[tmpStart]=[];}
this.events[tmpStart].push(d.data);if(tmpStart!==tmpEnd){let mom=dayjs(tmpStart,this.currentCfg.valueFormat).add(...this.currentCfg.stepEvent),tmp=mom.format(this.currentCfg.valueFormat);while(tmp<=tmpEnd){if(this.events[tmp]===undefined){this.events[tmp]=[];}
this.events[tmp].push(d.data);mom.add(...this.currentCfg.stepEvent);tmp=mom.format(this.currentCfg.valueFormat);}}});},init(){if(this.currentCfg&&bbn.fn.isFunction(this.currentCfg.make)){if(this.selection&&this.autoSelection&&this.currentCfg.valueFormat){this.currentValue=this.value?dayjs(this.value,this.currentCfg.valueFormat).format(this.currentCfg.valueFormat):'';this.$emit('input',this.currentValue);}
this.makeEvents();this.setTitle();this.currentCfg.make();this.$nextTick(()=>{this.setLabels(this.currentLabelsDates);this.$emit('init',true)});}},filterEvents(v){return[]
if(this.startField&&this.endField){return this.currentData&&bbn.fn.isArray(this.currentData)?bbn.fn.map(bbn.fn.filter(this.currentData,ev=>{if(ev.data[this.startField]&&ev.data[this.endField]){let start=dayjs(ev.data[this.startField],this.startFormat).format(this.currentCfg.valueFormat),end=dayjs(ev.data[this.endField],this.endFormat).format(this.currentCfg.valueFormat)
return(start<=v)&&(end>=v)}
return false}),ev=>{return ev.data}):[]}
return[]},setTitle(){if(this.currentCfg&&this.currentCfg.titleFormat){this.$set(this,'title',bbn.fn.isFunction(this.currentCfg.titleFormat)?this.currentCfg.titleFormat():this.currentDate.format(this.currentCfg.titleFormat));}},refresh(force){if(!force){let ev=new Event('dataLoad',{cancelable:true});this.$emit('dataLoad',ev,this);if(ev.defaultPrevented){return false;}}
this.$once('dataloaded',()=>{this.init();});this.updateData();},next(skip){skip=typeof skip==='boolean'?skip:false;if(this.currentCfg&&this.currentCfg.step&&bbn.fn.isFunction(this.currentCfg.make)){let check=dayjs(this.currentDate).add(...this.currentCfg[skip&&this.currentCfg.stepSkip?'stepSkip':'step']).format(this.currentCfg.valueFormat);if(this.max&&(check>this.max)){this.currentDate=dayjs(this.max,this.currentCfg.valueFormat);}
else{this.currentDate=dayjs(check,this.currentCfg.valueFormat);}
let ev=new Event('next',{cancelable:true});this.$emit('next',ev,this);if(ev.defaultPrevented){return false;}
this.refresh();}},prev(skip){skip=typeof skip==='boolean'?skip:false;if(this.currentCfg&&this.currentCfg.step&&bbn.fn.isFunction(this.currentCfg.make)){let check=dayjs(this.currentDate).subtract(...this.currentCfg[skip&&this.currentCfg.stepSkip?'stepSkip':'step']).format(this.currentCfg.valueFormat);if(this.min&&(check<this.min)){this.currentDate=dayjs(this.min,this.currentCfg.valueFormat);}
else{this.currentDate=dayjs(check,this.currentCfg.valueFormat);}
let ev=new Event('prev');this.$emit('prev',ev,this);if(ev.defaultPrevented){return false;}
this.refresh();}},select(val,notEmit){if(this.selection&&val){val=val===this.currentValue?'':val;this.currentValue=val;this.$emit('input',val);if(!notEmit){this.$emit('selected',val,this);}}},getPostData(){let start=dayjs(this.currentDate.format(bbn.fn.isFunction(this.currentCfg.startFormat)?this.currentCfg.startFormat():this.currentCfg.startFormat)),end=dayjs(this.currentDate.format(bbn.fn.isFunction(this.currentCfg.endFormat)?this.currentCfg.endFormat():this.currentCfg.endFormat)),data={};if(this.extraItems){if(this.currentCfg.startExtra){start.subtract(...this.currentCfg.startExtra);}
if(this.currentCfg.endExtra){end.add(...this.currentCfg.endExtra);}}
data[this.startField]=start.format(this.startFormat);data[this.endField]=end.format(this.endFormat);if(this.data){bbn.fn.extend(data,bbn.fn.isFunction(this.data)?this.data():this.data);}
return data;},setLabels(d){if(bbn.fn.isArray(d)&&d.length){this.currentLabels=d.map((l)=>{return l.format(this.getLabelsFormat());});}
else{this.currentLabels=[];}},onResize(){return new Promise((resolve,reject)=>{this.setLabels(this.currentLabelsDates);resolve();});}},beforeCreate(){if(bbn.env&&bbn.env.lang&&(bbn.env.lang!==dayjs.locale())){dayjs.locale(bbn.env.lang);}},mounted(){this.create();},watch:{type(newVal){this.ready=false;this.create();},currentLabelsDates(newVal){this.setLabels(newVal);},value(newVal,oldVal){if(newVal!==oldVal){this.currentValue=newVal;}},currentData(){this.init();}}})})(bbn);if(bbn_resolve){bbn_resolve("ok");}})(bbn);}