(bbn_resolve)=>{((bbn)=>{let script=document.createElement('script');script.innerHTML=`<div :class="[
        {
          'bbn-reset': true,
          'bbn-bordered': !modal,
          'bbn-background-internal': !modal,
          'bbn-invisible': !isResized,
          'bbn-floater-arrowed': !!arrow
        },
        componentClass
      ]"
      v-if="isVisible"
      @resize.stop="onResize"
      @mouseleave="isOver = false"
      @mouseenter="isOver = true"
      @keydown.esc.prevent.stop="close()"
      @subready.stop
      :style="currentStyle"
      v-resizable:container.left.right.bottom="ready && resizable ? $el.parentElement : false">
  <div v-if="arrow"
       :class="['bbn-floater-arrow', position]"/>
  <div :style="containerStyle"
       class="bbn-flex-height">
    <div v-if="modal"
         class="bbn-overlay bbn-modal"/>
    <header v-if="title"
            ref="header"
            :class="{
              'bbn-header': headerTitle,
              'bbn-bordered-bottom': true,
              'bbn-unselectable': true,
              'bbn-w-100': !isResizing
            }"
            v-draggable.mode.helper.container="!!draggable && ready ? {mode: 'move', helper: $el, container: $el.parentElement} : false">
      <div v-if="title"
          class="bbn-w-100 bbn-vxspadded">
        <h3 v-html="title"
            class="bbn-no-margin bbn-c"
            :style="{
              paddingLeft: maximizable || closable ? '3.6rem' : 'var(--space)',
              paddingRight: maximizable || closable ? '3.6rem' : 'var(--space)',
            }"
            ref="title"/>
      </div>
      <div class="bbn-top-right bbn-p bbn-h-100">
        <div v-if="maximizable !== false"
            class="bbn-h-100 bbn-middle bbn-reactive"
            @click.stop.prevent="isMaximized = !isMaximized"
            tabindex="0"
            :title="_('Full screen')">
          <i :class="'nf nf-mdi-window_' + (isMaximized ? 'restore' : 'maximize')"/>
        </div>
        <div v-if="closable !== false"
            class="bbn-h-100 bbn-middle bbn-reactive"
            @click.stop.prevent="close()"
            tabindex="0"
            :title="_('Close')">
          <i class="nf nf-fa-times"/>
        </div>
      </div>
    </header>
    <div :class="{
          'bbn-flex-fill': footer || title || (buttons && buttons.length),
          'bbn-h-100': !title && !footer && (!buttons || !buttons.length),
          'bbn-w-100': true,
          'bbn-flex-height': pageable
        }">
      <div v-if="pageable && ready">
        <bbn-pager class="bbn-table-footer bbn-no-border-right bbn-no-border-left bbn-no-border-bottom"
                  :element="pagerElement || _self"
                  @click.stop
                  @mousedown.stop
                  @mouseup.stop
                  @keydown.stop
                  @keyup.stop
                  :extra-controls="false"/>
      </div>
      <div :class="{'bbn-100': !ready || !pageable, 'bbn-flex-fill': pageable}">
        <bbn-scroll :latency="latency"
                    ref="scroll"
                    :class="{'bbn-flex-fill': pageable}"
                    @ready="scrollReady = true"
                    :scrollable="scrollable"
                    :axis="axis"
                    :max-width="isMaximized ? '100%' : currentMaxWidth || null"
                    :max-height="isMaximized ? '100%' : scrollMaxHeight || null"
                    :min-width="currentMinWidth || null"
                    :min-height="currentMinHeight > outHeight ? currentMinHeight - outHeight : null"
                    @resizecontent="scrollResize">
          <component v-if="component"
                    ref="component"
                    :is="component"
                    v-bind="realComponentOptions"/>
          <slot v-else-if="$slots.default"/>
          <div v-else-if="!!content"
              v-html="content"
              :class="scrollable ? 'bbn-block' : 'bbn-overlay'"
              :style="HTMLStyle"/>
          <bbn-list v-else-if="filteredData.length"
                    :mode="mode"
                    ref="list"
                    :suggest="suggest"
                    :source="filteredData"
                    :component="itemComponent"
                    :template="template"
                    :uid="uid"
                    :children="children"
                    :selected="selected"
                    :class="'bbn-floater-list bbn-menulist ' + mode"
                    origin="floater"
                    @select="select"
                    :source-value="sourceValue"
                    :source-text="sourceText"
                    :source-url="sourceUrl"
                    :source-action="sourceAction"
                    :groupable="groupable"
                    :source-group="sourceGroup"
                    :group-component="groupComponent"
                    :group-style="groupStyle"
                    :pageable="pageable"
                    :pager-element="pagerElement"/>
          <h3 v-else v-text="noData"/>
        </bbn-scroll>
      </div>
      <div v-if="pageable && ready">
        <bbn-pager class="bbn-table-footer bbn-no-border-right bbn-no-border-left bbn-no-border-bottom"
                  :element="_self"
                  @click.stop
                  @mousedown.stop
                  @mouseup.stop
                  @keydown.stop
                  @keyup.stop
                  :extra-controls="false"/>
      </div>
      <component is="style"
                v-if="css"
                scoped="scoped"
                v-html="css"/>
    </div>
    <div v-if="!title && closable">
      <div :class="{
        'bbn-top-right': true,
        'bbn-spadded': true,
        'bbn-xxxl': !!modal,
        'bbn-white': !!modal,
        'bbn-lg': !modal
      }">
        <i :class="closeIcon + ' bbn-p'"
           @click="close()"/>
      </div>
    </div>
    <footer v-if="footer"
            v-html="footer"
            class="bbn-w-100"
            ref="footer"/>
    <footer v-else-if="currentButtons.length"
            class="bbn-w-100 bbn-button-group"
            ref="buttons">
      <bbn-button v-for="(b, i) in currentButtons"
                  :key="i"
                  :ref="'button' + i"
                  @ready="t => focusable = t"
                  v-bind="b"
                  :class="['bbn-no-radius', {
                    'bbn-primary': b.preset === 'submit',
                    'bbn-no-border-right': !currentButtons[i + 1]
                  }, b.cls || '']"/>
    </footer>
  </div>
</div>`;script.setAttribute('id','bbn-tpl-component-floater');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);let css=document.createElement('link');css.setAttribute('rel','stylesheet');css.setAttribute('href',bbn.vue.libURL+'dist/js/components/floater/floater.css');document.head.insertAdjacentElement('beforeend',css);(function(Vue,bbn){"use strict";let isClicked=false;Vue.component('bbn-floater',{name:'bbn-floater',mixins:[bbn.vue.basicComponent,bbn.vue.listComponent,bbn.vue.componentInsideComponent,bbn.vue.dimensionsComponent,bbn.vue.resizerComponent,bbn.vue.keepCoolComponent,bbn.vue.toggleComponent,bbn.vue.positionComponent],props:{container:{},position:{type:String,validator:p=>['','topLeft','topRight','bottomLeft','bottomRight','top','bottom','left','right'].includes(p)},content:{type:String,default:''},css:{type:String},options:{type:Object},element:{type:Element},elementWidth:{type:Boolean,default:true},orientation:{type:String,default:'vertical',validator:o=>['vertical','horizontal'].includes(o)},scrollable:{type:Boolean,default:true},axis:{type:String,default:"both"},visible:{type:Boolean,default:true},mode:{type:String,default:"free",validator:m=>['free','options','selection'].includes(m)},level:{type:Number,default:0},itemComponent:{type:[Object,String,Function]},autoHide:{type:[Number,Boolean],default:false},title:{type:[Boolean,String]},footer:{type:[Function,String,Object]},buttons:{type:Array,default(){return[];}},closable:{type:Boolean,default:false},maximizable:{type:Boolean,default:false},animation:{type:Boolean,default:false},latency:{type:Number,default:50},onOpen:{type:Function},onSelect:{type:Function},beforeClose:{type:Function},onClose:{type:Function},afterClose:{type:Function},uid:{type:String},suggest:{type:[Boolean,Number],default:false},opener:{type:Vue},actionArguments:{type:Array},modal:{type:Boolean,default:false},pagerElement:{type:Vue},headerTitle:{type:Boolean,default:true},arrow:{type:Boolean,default:false},distance:{type:Number,default:0},draggable:{type:Boolean,default:false},resizable:{type:Boolean,default:false},distanceX:{type:Number,default:0},distanceY:{type:Number,default:0},groupable:{type:Boolean,default:false},sourceGroup:{type:String,default:'group'},groupComponent:{type:[String,Object,Vue]},groupStyle:{type:String},closeIcon:{type:String,default:'nf nf-fa-times'}},data(){let fns=[];if(this.onClose){fns.push(this.onClose);}
let opt=this.componentOptions||{};if(this.component&&this.source&&!bbn.fn.numProperties(opt)){opt.source=this.source;}
return{realComponentOptions:opt,closingFunctions:fns,currentTop:null,currentLeft:null,realHeight:null,realWidth:null,scrollWidth:null,scrollHeight:null,containerWidth:0,containerHeight:0,opacity:0,floaterHeight:0,floaterWidth:0,isMaximized:false,scrollMinWidth:0,outHeight:0,currentButtons:this.buttons.slice(),isOver:false,mouseLeaveTimeout:false,scrollResizeTimeout:false,isResized:false,isInit:false,definedWidth:null,definedHeight:null,resizerFn:null,scrollReady:false,scrollResized:false,forms:[],};},computed:{formattedLeft(){return this.currentLeft!==null?this.formatSize(this.currentLeft):'0px';},formattedTop(){return this.currentTop!==null?this.formatSize(this.currentTop):'0px';},formattedWidth(){return this.formatSize(this.width||(this.isResized?this.realWidth:this.currentMaxWidth||'100%'));},formattedHeight(){return this.formatSize(this.height||(this.isResized?this.realHeight:this.currentMaxHeight||'100%'));},currentStyle(){let s;if(this.isMaximized){s={top:0,left:0,width:'100%',height:'100%',};}
else{s={top:this.formattedTop,left:this.formattedLeft,width:this.formattedWidth,height:this.formattedHeight};if(this.currentMaxWidth){bbn.fn.extend(s,{maxWidth:this.formatSize(this.currentMaxWidth),minWidth:this.formatSize(this.currentMinWidth),maxHeight:this.formatSize(this.currentMaxHeight),minHeight:this.formatSize(this.currentMinHeight)});}}
s.visibility=this.isResized&&this.isInit&&this.scrollReady?'visible':'hidden';return s;},containerStyle(){return{width:'100%',height:'100%'}},HTMLStyle(){this.scrollWidth=Math.min(this.scrollWidth,this.currentMaxWidth);this.scrollHeight=Math.min(this.scrollHeight,this.scrollMaxHeight-this.currentTop);let s={maxWidth:this.isMaximized?'100%':(this.currentMaxWidth+'px')||null,maxHeight:this.isMaximized?'100%':((this.scrollMaxHeight-this.currentTop)+'px')||null};return s;},hasContent(){return!!(this.content||this.component||this.filteredData.length||this.$slots.default);},isVisible(){return this.currentVisible&&this.hasContent;},isHorizontal(){if(!!this.position&&!this.position.startsWith('top')&&!this.position.startsWith('bottom')){return(this.position==='left')||(this.position==='right');}
return(this.orientation==='horizontal');},scrollMaxHeight(){return this.currentMaxHeight?this.currentMaxHeight-this.outHeight:null;},hasDimensions(){return!!(this.width&&this.height);},hasButtons(){return this.currentButtons.length>0;},anonymousComponent(){return this.$refs.component;},},methods:{_setMinMax(){let minWidth=[0];let minHeight=[0];let maxWidth=[bbn.env.width];let maxHeight=[bbn.env.height];let tmp=this.getDimensions(this.minWidth,this.minHeight);if(tmp.width){minWidth.push(tmp.width);}
if(tmp.height){minHeight.push(tmp.height);}
if(this.element&&this.elementWidth){tmp=this.element.getBoundingClientRect();if(tmp.width){if(!this.maxWidth||(this.maxWidth>tmp.width)){minWidth.push(tmp.width);}}}
tmp=this.getDimensions(this.maxWidth,this.maxHeight);if(tmp.width){maxWidth.push(tmp.width);}
if(tmp.height){maxHeight.push(tmp.height);}
let coord={};if(this.container){coord=(bbn.fn.isDom(this.container)?this.container:this.$el.offsetParent).getBoundingClientRect();if(coord.width){maxWidth.push(Math.round(coord.width));}
if(coord.height){maxHeight.push(Math.round(coord.height));}}
this.containerWidth=coord.width||bbn.env.width;this.containerHeight=coord.height||bbn.env.height;if(this.element){let coord=this.element.getBoundingClientRect();if(this.isHorizontal){maxHeight.push(Math.max(coord.y+coord.height,bbn.env.height-coord.y));}
else{maxHeight.push(Math.max(coord.y,bbn.env.height-coord.y-coord.height));}}
if(this.left!==undefined){maxWidth.push(Math.max(this.left,bbn.env.width-this.left));}
if(this.right!==undefined){maxWidth.push(Math.max(this.right,bbn.env.width-this.right));}
if(this.top!==undefined){maxHeight.push(Math.max(this.top,bbn.env.height-this.top));}
if(this.bottom!==undefined){maxHeight.push(Math.max(this.bottom,bbn.env.height-this.bottom));}
let outHeight=0;if(this.title){let header=this.getRef('header');if(header){outHeight+=header.offsetHeight;}}
if(this.footer){let footer=this.getRef('footer');if(footer){outHeight+=footer.offsetHeight;}}
else if(this.currentButtons){let footer=this.getRef('buttons');if(footer){outHeight+=footer.offsetHeight;}}
if(outHeight!==this.outHeight){this.outHeight=outHeight;}
tmp=false;this.currentMinWidth=Math.max(...minWidth);this.currentMinHeight=Math.max(...minHeight);this.currentMaxHeight=Math.min(...maxHeight);this.currentMaxWidth=Math.min(...maxWidth);if((maxHeight<minHeight)||(maxHeight<minHeight)){throw new Error(bbn._("Wrong min/max width/height set in the properties"));}
if(this.width||this.height){tmp=this.getDimensions(this.width,this.height);if(tmp){if(tmp.width&&(tmp.width>this.currentMaxWidth)){tmp.width=this.currentMaxWidth;}
if(tmp.width&&(this.currentMaxWidth>=tmp.width)&&(this.currentMinHeight<=tmp.width)){this.definedWidth=tmp.width;}
else if(this.definedWidth){this.definedWidth=null;}
if(tmp.height&&(tmp.height>this.currentMaxHeight)){tmp.height=this.currentMaxHeight;}
if(tmp.height&&(this.currentMaxHeight>=tmp.height)&&(this.currentMinHeight<=tmp.height)){this.definedHeight=tmp.height;}
else if(this.definedHeight){this.definedHeight=null;}}}},_getCoordinates(){if(this.element){let coor=this.element.getBoundingClientRect();return{top:this.isHorizontal?coor.top:coor.bottom,bottom:this.currentMaxHeight-(this.isHorizontal?coor.bottom:coor.top),left:this.isHorizontal?coor.right:coor.left,right:this.currentMaxWidth-(this.isHorizontal?coor.left:coor.right)};}
else{return{top:bbn.fn.isNumber(this.top)?this.top:null,right:bbn.fn.isNumber(this.right)?this.right:null,bottom:bbn.fn.isNumber(this.bottom)?this.bottom:null,left:bbn.fn.isNumber(this.left)?this.left:null};}},show(){this.currentVisible=true;},hide(){this.currentVisible=false;},onResize(force){if((!this.scrollable||this.scrollResized)&&this.isVisible&&this.$el&&(this.setContainerMeasures()||!this.isInit||force)){return this.realResize();}
return new Promise(resolve=>{setTimeout(()=>{resolve();},0);});},fullResize(){this.isResized=false;this.realResize();},realResize(){return this.keepCool(()=>{let p;let go=this.isVisible&&this.scrollReady&&bbn.fn.isDom(this.$el)&&this.isActiveResizer()&&(!this.isResizing||!this.isResized);if(go){this.isResizing=true;this._setMinMax();}
return new Promise(resolve=>{if(go){if(this.definedWidth&&this.definedHeight&&(this.definedWidth>=this.currentMinWidth)&&(this.definedWidth<=this.currentMaxWidth)&&(this.definedHeight>=this.currentMinHeight)&&(this.definedHeight<=this.currentMaxHeight)){if((this.realWidth!==this.definedWidth)||(this.realHeight!==this.definedHeight)){this.currentWidth=this.definedWidth;this.realWidth=this.definedWidth;this.currentHeight=this.definedHeight;this.realHeight=this.definedHeight;this.updatePosition();resolve(1);return;}
resolve(0);return;}
else{if(this.resizerFn){clearTimeout(this.resizerFn);}
this.resizerFn=setTimeout(()=>{this.resizerFn=false;let scroll=this.getRef('scroll');if(!scroll||!scroll.ready){resolve(0);return;}
let naturalWidth;let naturalHeight;scroll.$el.style.width=this.formatSize(this.currentMaxWidth||'100%');scroll.$el.style.height=this.formatSize(this.currentMinHeight||'0px');let containerEle=scroll.getRef('scrollContainer');let contentEle=scroll.getRef('scrollContent');naturalHeight=contentEle.scrollHeight;if(!naturalHeight){this.isResizing=false;resolve();return;}
let w=scroll.$el.clientWidth;naturalWidth=contentEle&&contentEle.children[0]?contentEle.children[0].clientWidth:0;if(!naturalWidth||(naturalWidth>=w)){let step=Math.ceil(w/10);let num=1;scroll.$el.style.height=this.formatSize(naturalHeight);let testWidth=w;naturalWidth=w;while((testWidth>0)&&(naturalHeight===containerEle.scrollHeight)&&(containerEle.scrollWidth===containerEle.clientWidth)){naturalWidth=testWidth;testWidth=w-(num*step);scroll.$el.style.width=this.formatSize(testWidth);num++;}
if(step>=40){scroll.$el.style.width=this.formatSize(naturalWidth);num=1;w=naturalWidth;testWidth=naturalWidth;step=20;while((testWidth>0)&&(naturalHeight===containerEle.scrollHeight)&&(containerEle.scrollWidth===containerEle.clientWidth)){naturalWidth=testWidth;testWidth=w-(num*step);scroll.$el.style.width=this.formatSize(testWidth);num++;}}}
scroll.$el.style.width=null;scroll.$el.style.height=null;let dimensions={w:naturalWidth,h:naturalHeight};let scrollChange=false;if(this.scrollWidth!==dimensions.w){scrollChange=true;this.scrollWidth=dimensions.w;}
if(this.scrollHeight!==dimensions.h){scrollChange=true;this.scrollHeight=dimensions.h;}
let currentHeight=this.definedHeight||0;let currentWidth=this.definedWidth||0;if(!currentHeight){currentHeight=this.scrollHeight+this.outHeight;}
if(currentHeight>this.currentMaxHeight){currentHeight=this.currentMaxHeight;}
if(!currentWidth){currentWidth=this.scrollWidth;}
if(currentWidth>this.currentMaxWidth){currentWidth=this.currentMaxWidth;}
if(currentHeight<this.currentMinHeight){currentHeight=this.currentMinHeight;}
if(currentWidth<this.currentMinWidth){currentWidth=this.currentMinWidth;}
let isChanged=0;if(!this.realWidth||(Math.abs(this.realWidth-currentWidth)>2)){isChanged=1;this.realWidth=currentWidth;}
if(!this.realHeight||(Math.abs(this.realHeight-currentHeight)>2)){isChanged=1;this.realHeight=currentHeight;}
resolve(isChanged);},this.latency);}}
else{resolve(0);return;}}).then(r=>{if(r){let wasInit=this.isInit;if(!this.isInit){this.isInit=true;}
this.$nextTick(()=>{this.isResizing=false;this.$nextTick(()=>{this.setResizeMeasures();this.$nextTick(()=>{this.updatePosition();if(!this.isResized){this.isResized=true;}
this.$emit('resize');if(!wasInit){if(this.onOpen){this.onOpen(this);}
this.$emit('open',this);}});});});}
else if(go&&this.isInit){this.updatePosition();this.isResizing=false;}});},'scroll',20);},getDimensions(width,height){if(bbn.fn.isNumber(width,height)&&height&&width){return{width:parseInt(width),height:parseInt(height)};}
let r={width:0,height:0};let parent=this.container||this.$root.$el;if(parent&&(width||height)){if(!parent.insertAdjacentElement){throw new Error("Impossible to insert adjacent element to calculate dimensions");}
let el=document.createElement('div');el.style.position='absolute';el.style.visibility='hidden';el.className='bbn-reset'
el.style.width=this.formatSize(width);el.style.height=this.formatSize(height);try{parent.insertAdjacentElement('beforeend',el);r={width:el.offsetWidth||el.clientWidth||null,height:el.offsetHeight||el.clientHeight||null};}
catch(e){bbn.fn.log("ERROR",e,this.$el);}
el.remove();}
return r;},updatePosition(){let r={x:{camel:'Width',posStart:'left',posEnd:'right',ideal:this.isHorizontal?'right':'left',nideal:this.isHorizontal?'left':'right',res:null,},y:{camel:'Height',posStart:'top',posEnd:'bottom',ideal:this.isHorizontal?'top':'bottom',nideal:this.isHorizontal?'bottom':'top',res:null}};let coor=this.element?JSON.parse(JSON.stringify(this.element.getBoundingClientRect())):{top:bbn.fn.isNumber(this.top)?this.top:null,right:bbn.fn.isNumber(this.right)?this.right:null,bottom:bbn.fn.isNumber(this.bottom)?this.bottom:null,left:bbn.fn.isNumber(this.left)?this.left:null};let ok=true;bbn.fn.iterate(r,(a,ax)=>{let scroll=false;let size=this['real'+a.camel];if(!size){ok=false;return false;}
let min=0;if(this.element){if(!!this.position){let isTop=this.position.startsWith('top')||(this.position==='left')||(this.position==='right'),isLeft=this.position.endsWith('Left')||(this.position==='left')||(this.position==='top')||(this.position==='bottom'),inverted=0;if(ax==='x'){if(isLeft){a.res=this.isHorizontal?(coor.left-size):coor.left;if(a.res+size>this['container'+a.camel]){inverted=this.isHorizontal?coor.right:(coor.right-size)}}
else{a.res=this.isHorizontal?coor.right:(coor.right-size);if(a.res+size>this['container'+a.camel]){inverted=this.isHorizontal?(coor.left-size):coor.left;}}}
else{if(isTop){a.res=this.isHorizontal?coor.top:(coor.top-size);if(a.res+size>this['container'+a.camel]){inverted=this.isHorizontal?(coor.bottom-size):coor.bottom;}}
else{a.res=this.isHorizontal?(coor.bottom-size):coor.bottom;if(a.res+size>this['container'+a.camel]){inverted=this.isHorizontal?coor.top:(coor.top-size);}}}
if(!!inverted){if((inverted+size)<this['container'+a.camel]){a.res=inverted;}
else{a.res=0;size=this['container'+a.camel];}}}
else if(coor[a.ideal]+size>this['container'+a.camel]){let spaceAfter=this['container'+a.camel]-coor[a.ideal];let spaceBefore=coor[a.nideal];let isBeforeBigger=spaceBefore>spaceAfter;if(isBeforeBigger){if(spaceBefore<=size){a.res=0;size=spaceBefore;}
else{a.res=coor[a.nideal]-size;}}
else{a.res=coor[a.ideal];size=spaceAfter;}}
else{a.res=coor[a.ideal];}}
else{if((coor[a.posStart]!==null)||(coor[a.posEnd]!==null)){a.res=coor[a.posStart]!==null?coor[a.posStart]:this['container'+a.camel]-coor[a.posEnd]-size;}
else{coor[a.posStart]=Math.floor((this['container'+a.camel]-size)/ 2)
+((this['container'+a.camel]-size)%2);if(coor[a.posStart]<0){coor[a.posStart]=0;}
if(coor[a.posStart]+size>this['container'+a.camel]){if(this[a.posStart]===undefined){coor[a.posStart]=this['container'+a.camel]-size;}
scroll=true;}
else if(coor[a.posEnd]+size>this['container'+a.camel]){if(this[a.posEnd]!==undefined){coor[a.posEnd]=this['container'+a.camel]-size;}
scroll=true;}
if(a.res===null){if(coor[a.posStart]!==undefined){a.res=coor[a.posStart];}
else if(scroll){a.res=0;}
else{a.res=this['container'+a.camel]-(coor[a.posEnd]||0)-size;}}
a.res=a.res?a.res+min:min;if(a.res<0){a.res=0;}}}
if(size!==this['real'+a.camel]){this['real'+a.camel]=size;}});if(ok&&(r.x.res!==null)&&(r.y.res!==null)){let offset=0;if(this.position=='left'){offset=-this.distance;}
if(this.position=='right'){offset=this.distance;}
this.currentLeft=Math.ceil(r.x.res+offset);let topPositions=['topLeft','topRight','top'];let bottomPositions=['bottomLeft','bottomRight','bottom'];offset=0;if(topPositions.indexOf(this.position)!==-1){offset=-this.distance;}
if(bottomPositions.indexOf(this.position)!==-1){offset=this.distance;}
this.currentTop=Math.ceil(r.y.res+offset);}},scrollResize(e,dimensions){if(!this.scrollResized){this.scrollResized=true;}
e.preventDefault();if((dimensions.width!==this.scrollWidth)||(dimensions.height!==this.scrollHeight)){this.onResize(true);}},addClose(fn){for(let i=0;i<arguments.length;i++){if(typeof arguments[i]==='function'){this.closingFunctions.push(arguments[i])}}},removeClose(fn){if(!fn){this.closingFunctions=[];}
else{this.closingFunctions=bbn.fn.filter(this.closingFunctions,f=>{return fn!==f;})}},pressKey(e){switch(e.key){case"Enter":case"Space":this.select(this.currentIndex);break;case"Escape":case"ArrowLeft":if(this.closable){this.$emit('close');}
break;case"ArrowDown":if(this.items.length){if(this.currentIndex>this.items.length-2){this.currentIndex=0;}else{this.currentIndex++;}}
break;case"ArrowUp":if(this.items.length){if(this.currentIndex>0){this.currentIndex--;}else{this.currentIndex=this.items.length-1;}}
break;}},close(force,confirm=false){if(force!==true){if(!this.closable&&!this.autoHide&&!force){return;}
if(bbn.fn.isFunction(this.beforeClose)){if(this.beforeClose(this)===false){return;}}
else{let beforeCloseEvent=new Event('beforeClose',{cancelable:true});this.$emit('beforeClose',beforeCloseEvent,this);if(beforeCloseEvent.defaultPrevented){return;}}
if(this.closingFunctions){for(let i=0;i<this.closingFunctions.length;i++){if(this.closingFunctions[i](this)===false){return;}}}}
let popup=this.$parent&&bbn.fn.isDom(this.$parent.$el)&&(this.$parent.$el.className.indexOf('bbn-popup')>-1)?this.$parent:null;if(this.forms.length&&!confirm){this.forms[0].closePopup(force);}
else if(popup&&this.uid){let idx=popup.getIndexByUID(this.uid);popup.close(idx,true);this.$destroy();}
else{this.hide();this.$emit('close');}},closeAll(){if(this.level){let ancestors=this.ancestors('bbn-floater');for(let i=this.level;i>=0;i--){if(ancestors[i]){ancestors[i].close(true);}}}
this.close(true);},select(item,idx,dataIndex,ev){if(item&&!item.disabled&&!item[this.children]){if(!ev){let ev=new Event('select',{cancelable:true});}
if(this.onSelect){this.onSelect(item,idx,dataIndex,ev,this);}
else{this.$emit("select",item,idx,dataIndex,ev,this);}
if(ev.defaultPrevented){return;}
if(this.mode!=='options'){this.closeAll();}
if(this.mode==='options'){item.selected=!item.selected;}
else if((this.mode==='selection')&&!item.selected){let prev=bbn.fn.search(this.filteredData,"selected",true);if(prev>-1){this.filteredData[prev].selected=false;}
item.selected=true;}}},updateData(){if(this.component||this.$slots.default||this.content){return this.$nextTick()}
return bbn.vue.listComponent.methods.updateData.apply(this);}},created(){this.componentClass.push('bbn-resize-emitter');this.isResizing=true;},mounted(){if(this.isVisible){this.ready=true;}
this.$nextTick(()=>{let ancestors=this.ancestors('bbn-floater');if(this.element){let ct=ancestors.length?ancestors[ancestors.length-1]:this;let scroll=ct.closest('bbn-scroll');if(scroll){scroll.$once('scroll',()=>{this.close();});this.realResize();}}});},beforeDestroy(){if(this.onClose){this.onClose(this);}},updated(){},watch:{left(){this.updatePosition();},right(){this.updatePosition();},top(){this.updatePosition();},bottom(){this.updatePosition();},source:{deep:true,handler(){if(this.currentData.length){this.updateData();}}},visible(v){this.currentVisible=v;},isVisible(v){if(v){if(!this.ready){this.ready=true;}
else{this.onResize(true);}
if(this.onOpen){this.onOpen(this);}
this.$emit('open',this);}
else if(this.onClose){this.onClose(this);}},scrollReady(v){if(v){this.realResize();}},element(newVal){if(newVal&&this.ready){this.currentVisible=false;this.$forceUpdate();this.$nextTick(()=>{this.currentVisible=true;});}},isOver(v){this.$emit(v?'mouseenter':'mouseleave');if(this.autoHide&&this.isResized&&this.ready&&!this.isResizing){if(v&&this.mouseLeaveTimeout){clearTimeout(this.mouseLeaveTimeout);}
else if(!v){this.mouseLeaveTimeout=setTimeout(()=>{if(!this.isOver){this.close();}
this.mouseLeaveTimeout=false;},bbn.fn.isNumber(this.autoHide)?this.autoHide:1500);}}},hasButtons(){this.lastKnownCtWidth=0;this.lastKnownCtHeight=0;this.realResize();},filteredData:{deep:true,handler(){this.realResize()}},filteredTotal(){if(this.isVisible){this.onResize(true);}}}});})(window.Vue,window.bbn);if(bbn_resolve){bbn_resolve("ok");}})(bbn);}