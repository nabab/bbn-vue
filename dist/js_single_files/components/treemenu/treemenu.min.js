((bbn)=>{let script=document.createElement('script');script.innerHTML=`<div :class="[{'bbn-widget': true, 'bbn-h-100': true}, componentClass]">
  <div class="bbn-flex-height">

    <div class="bbn-block bbn-w-100 bbn-vpadded bbn-c" v-if="menus && menus.length">
      <bbn-dropdown v-model="currentMenu"
                    :source="menus"
                    :storage="true"
                    storage-full-name="appui-menu-main-dropdown"
                    style="width: 80%"
                    ref="dropdown"
      ></bbn-dropdown>
    </div>
    <div class="bbn-block bbn-w-100 bbn-bottom-padded bbn-c" v-if="search">
      <!--bbn-search name="search" style="width: 80%" ref="search" :placeholder="placeholder"></bbn-search-->
      <bbn-input name="search"
                 v-model="searchExp"
                 style="width: 80%"
                 ref="search"
                 autocomplete="off"
                 :placeholder="placeholder"
      ></bbn-input>
    </div>
    <div class="bbn-w-100 bbn-flex-fill">
      <div class="bbn-overlay">
        <bbn-tree :source="source"
                  :hybrid="true"
                  :map="mapSrc"
                  :data="getData"
                  :autobind="false"
                  :opened="true"
                  ref="tree"
                  @load="resizeScroll"
                  :quick-filter="searchExp"
                  :excluded-section-filter="true"
                  @nodeClick="go"
                  :menu="getMenu"
                  @ready="readyTree"
        ></bbn-tree>
      </div>
    </div>
  </div>
</div>
`;script.setAttribute('id','bbn-tpl-component-treemenu');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);(bbn=>{"use strict";Vue.component('bbn-treemenu',{name:'bbn-treemenu',mixins:[bbn.vue.basicComponent,bbn.vue.resizerComponent],props:{placeholder:{type:String,default:bbn._('Search')},source:{type:[String,Array,Function],default(){return[];}},shortcuts:{type:Boolean,default:false},search:{type:Boolean,default:true},menus:{type:Array,default(){return[];}},current:{type:String}},data(){let isAjax=!Array.isArray(this.source)
return{searchExp:'',posTop:this.top,posBottom:this.bottom,isAjax:isAjax,items:isAjax?[]:this.source,currentMenu:this.current||null,lastMenu:null};},computed:{elementStyle(){let o={top:'0px',bottom:'0px'};let prop=this.position==='right'?'right':'left';o[prop]=0;if(!this.ready){o.opacity=0;}
else if(!this.isOpened){o[prop]=-(this.$el.clientWidth+40)+'px';}
return o;}},methods:{getMenu(node){if(!this.shortcuts||node.numChildren){return[];}
let obj={url:node.data.link,icon:node.icon,text:node.text,id:node.data.id};return[{text:bbn._('Create a shortcut'),icon:'nf nf-fa-external_link',action:()=>{this.$emit('shortcut',obj);}}];},mapSrc(data,level){data.cls='bbn-treemenu-'+(level>6?x:level);if(level<3){data.cls+=' bbn-bottom-sspace';}
if(data.items&&data.items.length){data.cls+=' bbn-b';data.selectable=false;}
return data;},go(node,event){event.preventDefault();this.searchExp='';if(node&&node.data&&(node.data.link||node.data.url)){bbn.fn.link(node.data.link||node.data.url);this.$emit('select',node,event);}},resizeScroll(){if(this.$refs.scroll){this.$refs.scroll.onResize()}
let code=bbn.fn.md5(JSON.stringify(this.currentMenu));if(code!==this.lastMenu){this.lastMenu=code;this.$nextTick(()=>{this.focusSearch();})}},reset(){let tree=this.getRef('tree');if(bbn.fn.isVue(tree)){tree.reset();}},getData(){return{menu:this.currentMenu};},readyTree(){this.$nextTick(()=>{let dd=this.getRef('dropdown');if(bbn.fn.isVue(dd)&&dd.value&&bbn.fn.getRow(this.menus,{value:dd.value})&&(dd.value!==this.currentMenu)){this.currentMenu=dd.value;}
else{this.reset();}})},focusSearch(){if(!bbn.fn.isMobile()){let search=this.getRef('search');if(search){search.focus();}}}},mounted(){this.onResize();this.ready=true;},watch:{currentMenu(val){if((val!==null)&&bbn.fn.isVue(this.getRef('tree'))){this.reset();}}}});})(bbn);})(bbn);