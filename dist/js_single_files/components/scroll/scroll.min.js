((bbn)=>{let script=document.createElement('script');script.innerHTML=`<div :class="elementClass"
     :style="elementStyle"
>
  <div :class="{
         'bbn-scroll-container': true,
         'bbn-overlay': isScrolling || (!isMeasuring && !scrollable),
         'bbn-scroll-not-dragged': !isDragging
       }"
       ref="scrollContainer"
       @scroll="onScroll"
       @touchmove="touchmove"
       @focus="isFocused = true"
       @blur="isFocused = false"
       :tabindex="scrollable ? '0' : '-1'"
  >
    <div :class="{
          'bbn-scroll-content': true,
          resizing: isMeasuring,
          'bbn-overlay': !scrollable,
          'bbn-100': fullPage
        }"
         ref="scrollContent"
         @subready.stop="waitReady"
         :style="contentStyle"
    >
      <slot></slot>
    </div>
  </div>
  <bbn-scrollbar v-if="scrollReady && hasScrollX"
                 :hidden="scrollReady && hiddenX"
                 orientation="horizontal"
                 ref="xScroller"
                 :color="barColor ? barColor : ''"
                 :scrollAlso="scrollAlso"
                 :initial="currentX"
                 @scroll="scrollHorizontal"
                 :offset="offsetX"
  >
  </bbn-scrollbar>
  <bbn-scrollbar v-if="scrollReady && hasScrollY"
                 :hidden="scrollReady && hiddenY"
                 orientation="vertical"
                 ref="yScroller"
                 :color="barColor ? barColor : ''"
                 :scrollAlso="scrollAlso"
                 :initial="currentY"
                 @scroll="scrollVertical"
                 :offset="offsetY"
  >
  </bbn-scrollbar>
</div>`;script.setAttribute('id','bbn-tpl-component-scroll');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);(function(bbn){"use strict";Vue.component('bbn-scroll',{name:'bbn-scroll',mixins:[bbn.vue.basicComponent,bbn.vue.resizerComponent,bbn.vue.keepCoolComponent],props:{maxWidth:{type:Number},maxHeight:{type:Number},minWidth:{type:Number},minHeight:{type:Number},width:{type:Number},height:{type:Number},classes:{type:String,default:""},speed:{type:Number,default:50},axis:{type:String,default:"both"},scrollAlso:{type:[HTMLElement,Array,Function],default(){return[];}},x:{type:Number,default:0},y:{type:Number,default:0},hidden:{type:[Boolean,String],default:false},barColor:{type:String},latency:{type:Number,default:25},scrollable:{type:Boolean,default:true},fullPage:{type:Boolean,default:false},offsetX:{type:[Number,Array],default:0},offsetY:{type:[Number,Array],default:0},},data(){return{readyDelay:false,show:false,currentX:this.x,currentY:this.y,scrollPos:'0px',containerPadding:'0px',hiddenX:(this.hidden===true)||((this.hidden==='x')),hiddenY:(this.hidden===true)||((this.hidden==='y')),currentWidth:this.width||null,currentHeight:this.height||null,naturalWidth:0,naturalHeight:0,containerWidth:0,containerHeight:0,contentWidth:0,contentHeight:0,isMeasuring:false,hasScroll:false,hasScrollX:false,hasScrollY:false,promise:false,isScrolling:false,isDragging:false,isFocused:false,previousTouch:{x:null,y:null},interval:null,scrollReady:false};},computed:{elementClass(){let st=this.componentClass.join(' ')+' bbn-overlay';if(!this.ready){st+=' bbn-invisible';}
return st;},elementStyle(){let cfg={maxWidth:this.maxWidth?bbn.fn.formatSize(this.maxWidth):'100%',maxHeight:this.maxHeight?bbn.fn.formatSize(this.maxHeight):'100%',minWidth:this.minWidth?bbn.fn.formatSize(this.minWidth):'100%',minHeight:this.minHeight?bbn.fn.formatSize(this.minHeight):'100%',};if(this.isMeasuring){cfg.width='100%';cfg.height='100%';cfg.opacity=0;}
return cfg;},contentStyle(){let cfg={};if(this.minWidth){cfg.minWidth=this.minWidth;}
if(this.minHeight){cfg.minHeight=this.minHeight;}
if(this.maxWidth){cfg.maxWidth=this.maxWidth;}
if(this.maxHeight){cfg.maxHeight=this.maxHeight;}
if(this.isMeasuring||!this.scrollable){return cfg;}
cfg.width=(this.axis==='x')||(this.axis==='both')?'auto':'100%';cfg.height=(this.axis==='y')||(this.axis==='both')?'auto':'100%';return cfg;}},methods:{touchmove(e){if(this.fullPage){if(!this.isScrolling&&e.targetTouches&&e.targetTouches.length){let ev=e.targetTouches[0];let goingUp=false;let goingDown=false;let goingLeft=false;let goingRight=false;let dir='';let ct=this.getRef('scrollContainer');if(this.previousTouch.x!==null){if(this.hasScrollX&&(ev.pageX!==this.previousTouch.x)){let x=ct.scrollLeft;if(ev.pageX>this.previousTouch.x){goingLeft=true;x=this.currentX-ct.clientWidth;dir+=' left';}
else{x=this.currentX+ct.clientWidth;goingRight=true;dir+=' right';}
if((x!=this.currentX)&&this.$refs.xScroller){this.$refs.xScroller.scrollTo(x);}
this.currentX=x;if(!x){this.$emit('reachLeft');}
else if(x+ct.clientWidth>=ct.scrollWidth){this.$emit('reachRight');}}
if(this.hasScrollY&&(ev.pageY!==this.previousTouch.y)){let y=ct.scrollTop;if(ev.pageY>this.previousTouch.y){goingUp=true;y=this.currentY-ct.clientHeight;dir+=' up';}
else{goingDown=true;y=this.currentY+ct.clientHeight;dir+=' down';}
if((y!=this.currentY)&&this.$refs.yScroller){this.$refs.yScroller.scrollTo(y);}
this.currentY=y;if(!y){this.$emit('reachTop');}
else if(y+ct.clientHeight>=ct.scrollHeight){this.$emit('reachBottom');}}
if(dir){this.isScrolling=true;setTimeout(()=>{this.isScrolling=false;},200);}}
this.previousTouch.x=ev.pageX;this.previousTouch.y=ev.pageY;setTimeout(()=>{this.previousTouch.x=null;this.previousTouch.y=null;},250)}
e.preventDefault();}},preventKeyIfScrolling(e){if(this.isScrolling&&(32>=e.key<=40)){e.preventDefault();}},onScroll(e){if(!this.ready||(this.scrollable===false)){return;}
if(this.isScrolling||(this.fullPage&&bbn.fn.isMobile())){if(e&&e.preventDefault){e.preventDefault();}
return;}
let ct=this.getRef('scrollContainer');let x=ct.scrollLeft;if(this.hasScrollX&&(x!==this.currentX)){if(this.fullPage){this.isScrolling=true;setTimeout(()=>{this.isScrolling=false;},1500);if(x>this.currentX){x=this.currentX+ct.clientWidth;}
else if(x<this.currentX){x=this.currentX-ct.clientWidth;}
if((x!=this.currentX)&&this.$refs.xScroller){this.$refs.xScroller.scrollTo(x);}}
this.currentX=x;}
let y=ct.scrollTop;if(this.hasScrollY&&(y!==this.currentY)){if(this.fullPage){this.isScrolling=true;setTimeout(()=>{this.isScrolling=false;},1500);if(y>this.currentY){y=this.currentY+ct.clientHeight;}
else if(y<this.currentY){y=this.currentY-ct.clientHeight;}
if((y!=this.currentY)&&this.$refs.yScroller){this.$refs.yScroller.scrollTo(y);}}
this.currentY=y;}
if(this.scrollable){e.stopImmediatePropagation();}
this.$emit('scroll',e);},scrollTo(x,y){if(!this.hasScroll||!this.ready){return;}
if(this.hasScrollX&&(x!==undefined)&&(x!==null)&&this.$refs.xScroller){this.$refs.xScroller.scrollTo(x);}
if(this.hasScrollY&&(y!==undefined)&&(y!==null)&&this.$refs.yScroller){this.$refs.yScroller.scrollTo(y);}},scrollHorizontal(ev,left){this.currentX=left;this.$emit('scrollx',left);},scrollVertical(ev,top){this.currentY=top;this.$emit('scrolly',top);},addVertical(y){this.scrollTo(null,this.currentY+y)
this.$emit('scrolly',this.currentY);},addHorizontal(x){this.scrollTo(this.currentX+x)
this.$emit('scrollx',this.currentX);},scrollStart(){this.scrollStartX();this.scrollStartY();},scrollEnd(){this.scrollEndX();this.scrollEndY();},scrollBefore(){this.scrollBeforeX();this.scrollBeforeY();},scrollAfter(){this.scrollAfterX();this.scrollAfterY();},scrollStartX(){this.getRef('scrollContainer').scrollLeft=0;},scrollStartY(){if(this.hasScrollY){this.getRef('scrollContainer').scrollTop=0;}},scrollBeforeX(){let x=this.getRef('xScroller');if(x){x.scrollBefore();}},scrollBeforeY(){if(this.hasScrollY){let y=this.getRef('yScroller');if(y){y.scrollBefore();}}},scrollAfterX(){let x=this.getRef('xScroller');if(x){x.scrollAfter();}},scrollAfterY(){if(this.hasScrollY){let y=this.getRef('yScroller');if(y){y.scrollAfter();}}},scrollEndX(){this.getRef('scrollContainer').scrollLeft=this.contentWidth-this.lastKnownWidth;},scrollEndY(){this.getRef('scrollContainer').scrollTop=this.contentHeight-this.lastKnownHeight;},getNaturalDimensions(){this.isMeasuring=true;return new Promise((resolve,reject)=>{this.$nextTick().then(()=>{let sc=this.find('bbn-scroll');if(this.scrollable){let d={width:this.getRef('scrollContent').offsetWidth,height:this.getRef('scrollContent').offsetHeight};if(!d.width||!d.height){if(sc&&(sc.$el.clientWidth===this.$el.clientWidth)&&(sc.$el.clientHeight===this.$el.clientHeight)){sc.getNaturalDimensions().then((d)=>{this.naturalWidth=sc.naturalWidth;this.naturalHeight=sc.naturalHeight;this.isMeasuring=false;resolve({w:this.naturalWidth,h:this.naturalHeight});})}
else{this.naturalWidth=this.$el.offsetWidth;this.naturalHeight=this.$el.offsetHeight;this.isMeasuring=false;resolve({w:this.naturalWidth,h:this.naturalHeight});}}
else{this.naturalWidth=d.width;this.naturalHeight=d.height;this.isMeasuring=false;resolve({w:this.naturalWidth,h:this.naturalHeight});}}
else if(sc&&(sc.$el.clientWidth===this.$el.clientWidth)&&(sc.$el.clientHeight===this.$el.clientHeight)){sc.getNaturalDimensions().then((d)=>{this.naturalWidth=sc.naturalWidth;this.naturalHeight=sc.naturalHeight;this.isMeasuring=false;resolve({w:this.naturalWidth,h:this.naturalHeight});})}
else{this.naturalWidth=this.$el.offsetWidth;this.naturalHeight=this.$el.offsetHeight;this.isMeasuring=false;resolve({w:this.naturalWidth,h:this.naturalHeight});}});});},initSize(){return this.onResize().then(()=>{this.ready=true;});},onResize(force){if(!this.ready){return new Promise((resolve)=>{setTimeout(()=>{resolve();},1);});}
return this.keepCool(()=>{if(this.scrollable&&(this.setContainerMeasures()||force)){this.setResizeMeasures();let container=this.$el;let content=this.getRef('scrollContent');this.contentWidth=content.scrollWidth||content.offsetWidth;this.contentHeight=content.scrollHeight||content.offsetHeight;if(this.scrollable){if((this.axis==='both')||(this.axis==='x')&&(this.contentWidth>this.lastKnownCtWidth)){this.hasScrollX=true;this.$nextTick(()=>{if(this.$refs.xScroller){this.$refs.xScroller.onResize();}})}
else{this.hasScrollX=false;}
if((this.axis==='both')||(this.axis==='y')&&(this.contentHeight>this.lastKnownCtHeight)){this.hasScrollY=true;this.$nextTick(()=>{if(this.$refs.yScroller){this.$refs.yScroller.onResize();}})}
else{this.hasScrollY=false;}
this.hasScroll=this.hasScrollY||this.hasScrollX;if(this.currentX>this.contentWidth){this.currentX=this.contentWidth-this.containerWidth;}
if(this.currentY>this.contentHeight){this.currentY=this.contentHeight-this.containerHeight;}
container.scrollLeft=this.currentX;container.scrollTop=this.currentY;}
this.$emit('resize');}},'onResize',20);},waitReady(ev){if(!this.ready){if(this.readyDelay!==false){clearTimeout(this.readyDelay);}
this.readyDelay=setTimeout(()=>{this.readyDelay=false;this.initSize();},this.latency);}
else if(!ev||!ev.detail||!ev.detail.cp||!ev.detail.cp.$options||(ev.detail.cp.$options.name!=='bbn-floater')){this.keepCool(()=>{this.onResize();},"init",this.latency*2);}}},created(){this.componentClass.push('bbn-resize-emitter');},mounted(){setTimeout(()=>{if(!this.readyDelay&&!this.ready){this.waitReady();}},100)},beforeDestroy(){if(this.interval){clearInterval(this.interval);}},watch:{ready(newVal){if(newVal){setTimeout(()=>{if(this.interval){clearInterval(this.interval);}
this.interval=setInterval(()=>{if(this.scrollable&&this.$el.offsetParent){let content=this.getRef('scrollContent');let contentWidth=content.scrollWidth||content.offsetWidth;let contentHeight=content.scrollHeight||content.offsetHeight;if((contentWidth&&(this.contentWidth!==contentWidth)&&(!this.contentWidth||(Math.abs(contentWidth-this.contentWidth)>3)))||(contentWidth&&(this.contentWidth!==contentHeight)&&(!this.contentHeight||(Math.abs(contentHeight-this.contentHeight)>3)))){this.onResize(true);}}},1000);setTimeout(()=>{this.scrollReady=true;},1000);},100)}},scrollable(newVal){if(newVal){this.initSize();}},containerWidth(){let x=this.getRef('xScroller');if(x){x.onResize()}},containerHeight(){let y=this.getRef('yScroller');if(y){y.onResize()}},currentX(x){if(!x){this.$emit('reachLeft');}
else{let ct=this.getRef('scrollContainer');if(ct&&(x+ct.clientWidth>=ct.scrollWidth)){this.$emit('reachRight');}}},currentY(y){if(!y){this.$emit('reachTop');}
else{let ct=this.getRef('scrollContainer');if(ct&&(y+ct.clientHeight>=ct.scrollHeight)){this.$emit('reachBottom');}}}}});})(bbn);})(bbn);