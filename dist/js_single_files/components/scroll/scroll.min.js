((bbn)=>{let script=document.createElement('script');script.innerHTML=`<div :class="elementClass"
     :style="elementStyle">
  <div :class="containerClass"
       ref="scrollContainer"
       @scroll="onScroll"
       @touchend="onTouchend"
       @touchstart="onTouchstart"
       @touchmove="onTouchmove"
       @focus="isFocused = true"
       @blur="isFocused = false"
       :tabindex="scrollable ? '0' : '-1'">
    <div :class="{
          'bbn-scroll-content': true,
          resizing: isMeasuring,
          'bbn-w-100': !scrollable
        }"
         ref="scrollContent"
         @subready.stop="waitReady"
         :style="contentStyle">
      <slot/>
    </div>
  </div>
  <bbn-scrollbar v-if="scrollReady && hasScrollX"
                 :hidden="isResizing || !scrollReady || hiddenX"
                 orientation="horizontal"
                 ref="xScroller"
                 :color="barColor ? barColor : ''"
                 :scrollAlso="scrollAlso"
                 :initial="currentX"
                 @scroll="scrollHorizontal"
                 :offset="offsetX"/>
  <bbn-scrollbar v-if="scrollReady && hasScrollY"
                 :hidden="isResizing || !scrollReady || hiddenY"
                 orientation="vertical"
                 ref="yScroller"
                 :color="barColor ? barColor : ''"
                 :scrollAlso="scrollAlso"
                 :initial="currentY"
                 @scroll="scrollVertical"
                 :offset="offsetY"/>
</div>
`;script.setAttribute('id','bbn-tpl-component-scroll');script.setAttribute('type','text/x-template');document.body.insertAdjacentElement('beforeend',script);(function(bbn){"use strict";Vue.component('bbn-scroll',{name:'bbn-scroll',mixins:[bbn.vue.basicComponent,bbn.vue.resizerComponent,bbn.vue.keepCoolComponent,bbn.vue.eventsComponent],props:{maxWidth:{type:[String,Number]},maxHeight:{type:[String,Number]},minWidth:{type:[String,Number]},minHeight:{type:[String,Number]},width:{type:[String,Number]},height:{type:[String,Number]},speed:{type:Number,default:50},axis:{type:String,default:"both"},scrollAlso:{type:[HTMLElement,Array,Function],default(){return[];}},x:{type:Number,default:0},y:{type:Number,default:0},hidden:{type:[Boolean,String],default:false},barColor:{type:String},latency:{type:Number,default:25},scrollable:{type:Boolean,default:true},fullPage:{type:Boolean,default:false},disabled:{type:Boolean,default:false},offsetX:{type:[Number,Array],default:0},offsetY:{type:[Number,Array],default:0},stepX:{type:[Number,HTMLElement]},stepY:{type:[Number,HTMLElement]},afterScrollDelay:{type:Number,default:500}},data(){return{readyDelay:false,show:false,currentX:this.x||null,currentY:this.y||null,scrollPos:'0px',containerPadding:'0px',hiddenX:(this.hidden===true)||((this.hidden==='x')),hiddenY:(this.hidden===true)||((this.hidden==='y')),currentWidth:this.width||null,currentHeight:this.height||null,naturalWidth:0,naturalHeight:0,containerWidth:0,containerHeight:0,contentWidth:0,contentHeight:0,isMeasuring:false,hasScroll:false,hasScrollX:false,hasScrollY:false,promise:false,isScrolling:false,isDragging:false,isFocused:false,previousTouch:{x:null,y:null},interval:null,scrollReady:false,touchX:false,touchY:false,scrollInitial:false,touchDirection:null,scrollTimeout:null,currentStepX:bbn.fn.isDom(this.stepX)?this.stepX.clientHeight:this.stepX,currentStepY:bbn.fn.isDom(this.stepY)?this.stepY.clientHeight:this.stepY};},computed:{elementClass(){let st=this.componentClass.join(' ');if(!this.ready){st+=' bbn-invisible';}
if(!this.scrollable){st=bbn.fn.replaceAll('bbn-resize-emitter','',st)+' bbn-w-100';}
else{st+=' bbn-overlay';}
return st;},elementStyle(){let cfg={maxWidth:this.maxWidth?bbn.fn.formatSize(this.maxWidth):'',maxHeight:this.maxHeight?bbn.fn.formatSize(this.maxHeight):'',minWidth:this.minWidth?bbn.fn.formatSize(this.minWidth):'',minHeight:this.minHeight?bbn.fn.formatSize(this.minHeight):'',};if(this.isMeasuring){cfg.width='100%';cfg.height='100%';cfg.visibility='hidden';}
if(this.currentWidth){cfg.width=bbn.fn.formatSize(this.currentWidth);}
if(this.currentHeight){cfg.height=bbn.fn.formatSize(this.currentHeight);}
return cfg;},containerClass(){let cls='bbn-scroll-container bbn-no-scrollbar';if(!this.scrollable){cls+=' bbn-w-100';return cls;}
if(this.disabled){cls+=' bbn-scroll-disabled';}
if(this.ready&&!this.isDragging){cls+=' bbn-scroll-not-dragged';}
if(!this.isMeasuring&&!this.scrollable){cls+=' bbn-overlay';}
if(this.hasX()){cls+=' bbn-scroll-x';}
if(this.hasY()){cls+=' bbn-scroll-y';}
return cls;},contentStyle(){let cfg={};if(this.minWidth){cfg.minWidth=this.minWidth;}
if(this.minHeight){cfg.minHeight=this.minHeight;}
if(this.maxWidth){cfg.maxWidth=this.maxWidth;}
if(this.maxHeight){cfg.maxHeight=this.maxHeight;}
if(this.isMeasuring||!this.scrollable){return cfg;}
cfg.width=(this.axis==='x')||(this.axis==='both')?'auto':'100%';cfg.height=(this.axis==='y')||(this.axis==='both')?'auto':'100%';return cfg;}},methods:{hashJustChanged(length=600){if(document.location.hash){let now=(new Date()).getTime();if(bbn.env.hashChanged>=(now-length)){return true;}}
return false;},onTouchstart(e){if(!this.scrollable||this.disabled){return;}
if(e.targetTouches&&e.targetTouches.length){let ev=e.targetTouches[0];if(this.hasScrollX){this.touchX=ev.clientX;}
if(this.hasScrollY){this.touchY=ev.clientY;}
this.scrollInitial={x:this.currentX,y:this.currentY,touched:true};}},onTouchend(e){if(!this.scrollInitial){return;}
if(!this.scrollable||this.disabled){return;}
this.scrollInitial.touched='finished';this.setScrollDelay();},onTouchmove(e){this.$emit('touchmove',e);},onScroll(e){let ct=this.getRef('scrollContainer');if(ct){if(this.disabled){e.preventDefault();return;}
if(this.hasScrollX&&(ct.scrollLeft<0)){ct.scrollLeft=0;e.preventDefault();return;}
if(this.hasScrollY&&(ct.scrollTop<0)){ct.scrollTop=0;e.preventDefault();return;}
this.currentX=ct.scrollLeft;this.currentY=ct.scrollTop;this.$emit('scroll',e);if(!e.defaultPrevented){if(this.scrollInitial&&(this.scrollInitial.touched===true)){clearTimeout(this.scrollTimeout);return;}
if(this.hasScrollX&&this.$refs.xScroller&&bbn.fn.isNumber(this.$refs.xScroller.nextLevel)&&(Math.abs(this.currentX-this.$refs.xScroller.nextLevel)<2)){return;}
if(this.hasScrollY&&this.$refs.yScroller&&bbn.fn.isNumber(this.$refs.yScroller.nextLevel)&&(Math.abs(this.currentY-this.$refs.yScroller.nextLevel)<2)){return;}
if(!this.scrollInitial){this.scrollInitial={x:this.currentX,y:this.currentY};}
this.setScrollDelay();}}
if(this.scrollable&&e){e.stopImmediatePropagation();}},setScrollDelay(){clearTimeout(this.scrollTimeout);this.scrollTimeout=setTimeout(()=>{this.afterScroll();},this.scrollInitial.touched==='finished'?100:this.afterScrollDelay);},afterScroll(){if(this.fullPage&&this.scrollInitial){if(this.hasScrollX&&(this.currentX!==this.scrollInitial.x)){let m=this.currentStepX||this.containerWidth;let r1=this.scrollInitial.x?Math.round(this.scrollInitial.x / m):0;let r2=this.currentX?Math.round(this.currentX / m):0;let left;if(r1!==r2){left=r2*m;}
else if(this.scrollInitial.x<this.currentX){left=(r1+1)*m;}
else if(this.scrollInitial.x>this.currentX){left=(r1-1)*m;}
if(bbn.fn.isNumber(left)&&(left!==this.currentX)){this.$refs.xScroller.scrollTo(left,true).then(()=>{this.$emit('afterscroll');});}}
else if(this.hasScrollY&&(this.currentY!==this.scrollInitial.y)){let m=this.currentStepY||this.containerHeight;let r1=this.scrollInitial.y?Math.round(this.scrollInitial.y / m):0;let r2=this.currentY?Math.round(this.currentY / m):0;let top;if(r1!==r2){top=r2*m;}
else if(this.scrollInitial.y<this.currentY){top=(r1+1)*m;}
else if(this.scrollInitial.y>this.currentY){top=(r1-1)*m;}
if(bbn.fn.isNumber(top)&&(top!==this.currentY)){this.$refs.yScroller.scrollTo(top,true).then(()=>{this.$emit('afterscroll');});}
else{this.$emit('afterscroll');}}
this.scrollInitial=false;}},scrollTo(x,y,anim){return new Promise(resolve=>{if(!this.hasScroll||!this.ready){return;}
if(this.hasScrollX&&(x!==undefined)&&(x!==null)&&this.$refs.xScroller){this.$refs.xScroller.scrollTo(x,anim).then(()=>{if(this.hasScrollY&&(y!==undefined)&&(y!==null)&&this.$refs.yScroller){this.$refs.yScroller.scrollTo(y,anim).then(()=>{try{resolve();}
catch(e){}});}
else{try{resolve();}
catch(e){}}});}
else if(this.hasScrollY&&(y!==undefined)&&(y!==null)&&this.$refs.yScroller){this.$refs.yScroller.scrollTo(y,anim).then(()=>{try{resolve();}
catch(e){}});}})},scrollHorizontal(ev,left){this.currentX=left;this.$emit('scrollx',left);},scrollVertical(ev,top){this.currentY=top;this.$emit('scrolly',top);},addVertical(y){this.scrollTo(null,this.currentY+y)
this.$emit('scrolly',this.currentY);},addHorizontal(x){this.scrollTo(this.currentX+x)
this.$emit('scrollx',this.currentX);},scrollStart(anim){this.scrollStartX(anim);this.scrollStartY(anim);},scrollEnd(anim){this.scrollEndX(anim);this.scrollEndY(anim);},scrollBefore(anim){this.scrollBeforeX(anim);this.scrollBeforeY(anim);},scrollAfter(anim){this.scrollAfterX(anim);this.scrollAfterY(anim);},scrollStartX(anim){if(this.hasScrollX){let x=this.getRef('xScroller');if(x){x.scrollStart(anim);}}},scrollStartY(anim){if(this.hasScrollY){let y=this.getRef('yScroller');if(y){y.scrollStart(anim);}}},scrollBeforeX(anim){if(this.hasScrollX){let x=this.getRef('xScroller');if(x){x.scrollBefore(anim);}}},scrollBeforeY(anim){if(this.hasScrollY){let y=this.getRef('yScroller');if(y){y.scrollBefore(anim);}}},scrollAfterX(anim){if(this.hasScrollX){let x=this.getRef('xScroller');if(x){x.scrollAfter(anim);}}},scrollAfterY(anim){if(this.hasScrollY){let y=this.getRef('yScroller');if(y){y.scrollAfter(anim);}}},scrollEndX(anim){if(this.hasScrollX){let x=this.getRef('xScroller');if(x){x.scrollEnd(anim);}}},scrollEndY(anim){if(this.hasScrollY){let y=this.getRef('yScroller');if(y){y.scrollEnd(anim);}}},getNaturalDimensions(){this.isMeasuring=true;return new Promise((resolve,reject)=>{this.$nextTick(()=>{let sc=this.find('bbn-scroll');if(this.scrollable){let d={width:this.getRef('scrollContent').offsetWidth,height:this.getRef('scrollContent').offsetHeight};if(!d.width||!d.height){if(sc&&(sc.$el.clientWidth===this.$el.clientWidth)&&(sc.$el.clientHeight===this.$el.clientHeight)){sc.getNaturalDimensions().then(d=>{this.naturalWidth=sc.naturalWidth;this.naturalHeight=sc.naturalHeight;})}
else{this.naturalWidth=this.$el.offsetWidth;this.naturalHeight=this.$el.offsetHeight;}}
else{this.naturalWidth=d.width;this.naturalHeight=d.height;}}
else if(sc&&(sc.$el.clientWidth===this.$el.clientWidth)&&(sc.$el.clientHeight===this.$el.clientHeight)){sc.getNaturalDimensions().then(d=>{this.naturalWidth=sc.naturalWidth;this.naturalHeight=sc.naturalHeight;})}
else{this.naturalWidth=this.$el.offsetWidth;this.naturalHeight=this.$el.offsetHeight;}
this.isMeasuring=false;resolve({w:this.naturalWidth,h:this.naturalHeight});});});},hasX(){return this.scrollable&&((this.axis==='both')||(this.axis==='x'));},hasY(){return this.scrollable&&((this.axis==='both')||(this.axis==='y'));},initSize(){return this.onResize().then(()=>{this.ready=true;});},onResize(force){if(!this.ready){return new Promise(resolve=>{setTimeout(()=>{resolve();},1);});}
return this.keepCool(()=>{if(this.scrollable&&(this.setContainerMeasures()||force)){this.setResizeMeasures();let container=this.$el;let content=this.getRef('scrollContent');let ct=this.getRef('scrollContainer');if(!content||!container.clientWidth||!container.clientHeight){return;}
let x=ct.scrollLeft;let y=ct.scrollTop;let sendResizeContent=false;if((content.clientWidth!==this.contentWidth)||(content.clientHeight!==this.contentHeight)){sendResizeContent=true;}
this.contentWidth=content.scrollWidth;this.contentHeight=content.scrollHeight;this.containerWidth=container.clientWidth;this.containerHeight=container.clientHeight;if(this.scrollable){if(((this.axis==='both')||(this.axis==='x'))&&(this.contentWidth>this.containerWidth)){this.hasScrollX=true;this.$nextTick(()=>{if(this.$refs.xScroller){this.$refs.xScroller.onResize();}})}
else{this.hasScrollX=false;}
if(((this.axis==='both')||(this.axis==='y'))&&(this.contentHeight>this.containerHeight)){this.hasScrollY=true;this.$nextTick(()=>{if(this.$refs.yScroller){this.$refs.yScroller.onResize();}})}
else{this.hasScrollY=false;}
this.hasScroll=this.hasScrollY||this.hasScrollX;if(this.currentX>this.contentWidth){x=this.contentWidth-this.containerWidth;}
if(this.currentY>this.contentHeight){y=this.contentHeight-this.containerHeight;}
if(this.fullPage){if(this.hasScrollX){let tot=Math.round(x / this.containerWidth);x=this.containerWidth*tot;}
if(this.hasScrollY){let tot=Math.round(y / this.containerHeight);y=this.containerHeight*tot;}}
if(this.currentX>this.contentWidth){this.currentX=x;}
if(this.currentY>this.contentHeight){this.currentY=y;}
if(this.scrollReady&&bbn.fn.isNumber(this.currentX)&&(this.currentX!==ct.scrollLeft)){ct.scrollLeft=this.currentX;}
if(this.scrollReady&&bbn.fn.isNumber(this.currentY)&&(this.currentY!==ct.scrollTop)){ct.scrollTop=this.currentY;}}
this.$emit('resize');if(sendResizeContent){let e=new Event('resizecontent',{cancelable:true});this.$emit('resizecontent',e,{width:content.clientWidth,height:content.clientHeight});}}},'onResize',20);},waitReady(ev){if(!this.ready){if(this.readyDelay!==false){clearTimeout(this.readyDelay);}
this.readyDelay=setTimeout(()=>{this.readyDelay=false;this.initSize();},this.latency);}
else if(!ev||!ev.detail||!ev.detail.cp||!ev.detail.cp.$options||(ev.detail.cp.$options.name!=='bbn-floater')){this.keepCool(()=>{this.onResize();},"init",this.latency*2);}}},created(){this.componentClass.push('bbn-resize-emitter');},mounted(){setTimeout(()=>{if(!this.readyDelay&&!this.ready){this.waitReady();}},100)},beforeDestroy(){if(this.interval){clearInterval(this.interval);}},watch:{ready(newVal){if(newVal){if(this.interval){clearInterval(this.interval);}
this.interval=setInterval(()=>{if(this.scrollable&&this.$el.offsetParent&&this.isActiveResizer()){let container=this.getRef('scrollContent');let contentWidth=Math.max(container.scrollWidth,container.clientWidth);let contentHeight=Math.max(container.scrollHeight,container.clientHeight);if((contentWidth&&(this.contentWidth!==contentWidth)&&(!this.contentWidth||(Math.abs(contentWidth-this.contentWidth)>1)))||(contentHeight&&(this.contentHeight!==contentHeight)&&(!this.contentHeight||(Math.abs(contentHeight-this.contentHeight)>1)))){let e=new Event('resizecontent',{cancelable:true});this.$emit('resizecontent',e,{width:contentWidth,height:contentHeight});if(!e.defaultPrevented){this.onResize(true);}}}},1000);this.scrollReady=true;}},scrollable(newVal){if(newVal){this.initSize();}},containerWidth(){let x=this.getRef('xScroller');if(x){x.onResize();}},containerHeight(){let y=this.getRef('yScroller');if(y){y.onResize();}},currentX(x){if(!x){this.$emit('reachleft');}
else{let ct=this.getRef('scrollContainer');if(ct&&(x+ct.clientWidth>=ct.scrollWidth)){this.$emit('reachright');}}
this.$emit('scrollx',x);},currentY(y){if(!y){this.$emit('reachtop');}
else{let ct=this.getRef('scrollContainer');if(ct&&(y+ct.clientHeight>=ct.scrollHeight)){this.$emit('reachbottom');}}
this.$emit('scrolly',y);},stepX(val){this.currentStepX=bbn.fn.isDom(val)?val.clientHeight:val;},stepY(val){this.currentStepY=bbn.fn.isDom(val)?val.clientHeight:val;}}});})(bbn);})(bbn);