<div :class="{
      'bbn-appui': true,
      'bbn-observer': true,
      'bbn-background': true,
      'bbn-overlay': true,
      'bbn-mobile': isMobile,
      'bbn-desktop': !isMobile
     }"
     :style="{opacity: opacity}">
  <div v-if="!cool"
       class="bbn-middle bbn-xl"
       v-text="_('Appui is already defined') + '... :('">
  </div>
  <div class="bbn-flex-height" v-else-if="ready">
    <!-- HEADER -->
    <div v-if="header"
         class="bbn-w-100"
         style="overflow: visible">
      <div :class="{
        'bbn-header': true,
        'bbn-flex-width': true,
        'bbn-unselectable': true,
        'bbn-no-border': true,
      }">
        <!-- MENU BUTTON -->
        <div class="bbn-block bbn-h-100 bbn-menu-button-container"
             style="width: 50px; margin-right: 90px">
          <div tabindex="0"
               @keydown.enter="toggleMenu"
               @keydown.space="toggleMenu"
               @mousedown.prevent.stop="toggleMenu"
               class="bbn-overlay bbn-centered bbn-p">
            <i ref="icon" class="nf nf-fa-bars bbn-xxxl"> </i>
          </div>
        </div>
        <!-- SEARCHBAR -->
        <div class="bbn-abs bbn-h-100 bbn-vspadded"
             style="left: 50px; right: 140px; top: auto">
          <bbn-search :source="searchBar.source"
                      :placeholder="searchBar.placeholderFocused"
                      ref="search"
                      @select="searchBar.select"
                      :component="searchBar.component"
                      v-model="searchBar.value"
                      :suggest="true"
                      :source-value="searchBar.sourceValue"
                      :source-text="searchBar.sourceText"
                      :min-length="searchBar.minLength"
                      class="bbn-no"
          >
          </bbn-search>
        </div>
<!-- CENTRAL PART -->
        <div class="bbn-h-100 bbn-splitter-top-center bbn-flex-fill ">
          <!-- FISHEYE -->
          <bbn-fisheye v-if="plugins['appui-menu']"
                       style="z-index: 3"
                       v-show="'?' !== searchBar.value"
                       :class="{
                         'bbn-invisible': $refs.search && $refs.search.isFocused,
                         'bbn-spadded': true
                        }"
                       :removable="true"
                       @remove="removeShortcut"
                       ref="fisheye"
                       :source="shortcuts"
                       :fixed-left="leftShortcuts"
                       :fixed-right="rightShortcuts">
          </bbn-fisheye>
          <div v-else>
          </div>
        </div>
        <!-- LOGO -->
        <div class="bbn-block bbn-logo-container" style="max-width: 25%; min-height: 100%; width: 10em">
          <div class="apst-logo bbn-100 bbn-r">
            <img :src="logo + '?t=2'" style="border: 0; max-height: 100%; max-width: 100%; width: auto;" class="bbn-right-space">
          </div>
        </div>
        <!-- DEBUGGER? -->
        <div v-if="debug"
             class="bbn-widget"
             :style="{
               position: 'absolute',
               top: '0px',
               right: '0px',
               width: isOverDebug ? 'auto' : '200px',
               height: isOverDebug ? 'auto' : '200px',
               minWidth: '200px',
               minHeight: '200px',
               maxWidth: '200px',
               maxHeight: 'px',
               overflow: isOverDebug ? 'auto' : 'hidden'
             }"
             @mouseenter="isOverDebug = true"
             @mouseleave="isOverDebug = false">
          <h2>Debug...</h2>
        </div>
      </div>
    </div>
    <!-- MAIN -->
    <div class="bbn-flex-fill">
      <!--bbn-split-tabs v-if="tabnav"
                      orientation="horizontal"
                      ref="tabnav"
                      :root="root"
                      :resizable="true"
                      :observer="true"
                      :source="source">
      </bbn-split-tabs-->
      <bbn-router :root="root"
                  :source="source"
                  :storage="!!nav"
                  :observer="true"
                  :menu="tabMenu"
                  :single="single"
                  :post-base-url="!single"
                  ref="nav"
                  :nav="nav"
                  :master="true"
                  :class="{'bbn-overlay': !nav}"
                  :url="!!nav ? undefined : url"
                  @route="onRoute"
                  @change="$emit('change', $event)"
      >
        <slot></slot>
      </bbn-router>
    </div>
    <!-- STATUS -->
    <div v-if="status"
              ref="foot"
              class="bbn-header bbn-bordered-top"
              style="overflow: visible">
      <div class="bbn-flex-width bbn-h-100">
        <!-- LOADBAR -->
        <div class="bbn-flex-fill bbn-h-100 bbn-right-space">
          <bbn-loadbar v-if="loaders" ref="loading" :source="loaders"></bbn-loadbar>
        </div>
        <!-- TASK TRACKER -->
        <div v-if="plugins['appui-task']"
            class="bbn-h-100 bbn-vmiddle bbn-right-space"
        >
          <appui-task-tracker></appui-task-tracker>
        </div>
        <!-- CHAT -->
        <div v-if="plugins['appui-chat']"
             :class="['bbn-h-100', 'bbn-vmiddle', {'bbn-right-space': getRef('chat') && getRef('chat').usersOnlineWithoutMe.length}]"
        >
          <bbn-chat ref="chat"
                    :url="plugins['appui-chat']"
                    :user-id="app.user.id"
                    :users="app.users"
                    :online-users="usersOnline"
                    :online="chatOnline"
                    @send="sendChatMessage"
                    :groups="app.groups"
          >
          </bbn-chat>
        </div>
        <!-- CLIPBOARD BUTTON -->
        <div v-if="plugins['appui-clipboard'] && clipboard"
             @click.stop="getRef('clipboard').toggle()"
             ref="clipboardButton"
             :class="['bbn-appui-clipboard-button bbn-h-100 bbn-vmiddle bbn-block bbn-c bbn-right-space bbn-p']">
          <i class="nf nf-fa-clipboard bbn-m" tabindex="-1"></i>
          <input class="bbn-invisible bbn-overlay bbn-p"
                 @click.stop="getRef('clipboard').toggle()"
                 @keydown.space.enter.prevent="getRef('clipboard').toggle()"
                 @drop.prevent.stop="getRef('clipboard').copy($event); getRef('clipboard').show()">
        </div>
      </div>
    </div>
  </div>
  <!-- TREEMENU -->
  <bbn-slider v-if="plugins['appui-menu']"
              orientation="left"
              ref="slider"
              style="width: 35em"
              @show="focusSearchMenu"
              close-button="top-right">
    <bbn-treemenu :source="plugins['appui-menu'] + '/data'"
                  v-if="$refs.slider && $refs.slider.hasBeenOpened"
                  ref="menu"
                  @select="$refs.slider.hide()"
                  :menus="menus"
                  :current="currentMenu"
                  :top="50"
                  :shortcuts="true"
                  @shortcut="addShortcut"
                  @ready="menuMounted = true">
    </bbn-treemenu>
  </bbn-slider>
  <!-- CLIPBOARD SLIDER -->
  <bbn-clipboard v-if="plugins['appui-clipboard'] && clipboard"
                 :storage="true"
                 ref="clipboard"
                 :source="clipboardContent"
                 style="z-index: 13">
  </bbn-clipboard>

  <!-- POPUPS -->
  <bbn-popup :source="popups"
             ref="popup"
             :z-index="14">
  </bbn-popup>
  <!-- NOTIFICATIONS -->
  <bbn-notification ref="notification" :z-index="15"></bbn-notification>
  <!-- APP COMPONENT -->
  <component ref="app" :is="appComponent"></component>
</div>
