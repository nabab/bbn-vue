<div class="bbn-appui bbn-observer bbn-full-screen"
     style="opacity: 0;">
  <div v-if="!cool"
       class="bbn-middle bbn-xl"
       v-text="_('Appui is already defined... :(')">
  </div>
  <bbn-splitter v-else-if="isMounted"
                orientation="vertical"
                ref="splitter">
    <bbn-pane :size="50"
              :scrollable="false"
              ref="head"
              overflow="visible">
      <div class="k-header bbn-w-100 bbn-h-100 bbn-flex-width">
        <div class="bbn-block bbn-h-100 bbn-middle bbn-menu-button-container"
             style="width: 70px">
          <div tabindex="0"
               @keydown.enter="toggleMenu"
               @keydown.space="toggleMenu"
               @mousedown.prevent.stop="toggleMenu"
               class="bbn-full-screen bbn-middle bbn-p">
            <i ref="icon" class="fa fa-navicon bbn-xxxl"> </i>
          </div>
        </div>
        <div class="bbn-block bbn-h-100 bbn-vmiddle" style="width: 70px">
          <div class="bbn-global-search bbn-vmiddle bbn-lg">
            <bbn-autocomplete id="recherche"
                              :delay="500"
                              source-text="nom"
                              source-value="id"
                              :clear-button="false"
                              :suggest="true"
                              source="adherents"
                              ref="search"
                              placeholder="?"
                              v-model="search"
                              @focus="focusSearch"
                              icon="fa fa-search"
                              @blur="blurSearch"
                              @change="selectSearch"
                              :min-length="1"
                              :template="tplSearch"
                              style="z-index: 10">
            </bbn-autocomplete>
          </div>
        </div>
        <div class="bbn-h-100 bbn-splitter-top-center bbn-flex-fill">
          <bbn-fisheye del-url="menu/shortcuts/delete"
                       ins-url="menu/shortcuts/insert"
                       :min-index="3"
                       :z-index="3"
                       ref="fisheye"
                       :source="shortcuts"
                       :fixed-left="leftShortcuts"
                       :fixed-right="rightShortcuts"
                       @ready="fisheyeMounted = true">
          </bbn-fisheye>
        </div>
        <div class="bbn-block bbn-h-100 bbn-logo-container" style="width: 140px">
          <div class="apst-logo bbn-100 bbn-r">
            <img :src="logoPath" border="0" class="bbn-h-90">
          </div>
        </div>
        <div v-if="debug"
             class="k-widget"
             :style="{
               position: 'absolute',
               top: '0px',
               right: '0px',
               width: isOverDebug ? 'auto' : '200px',
               height: isOverDebug ? 'auto' : '200px',
               minWidth: '200px',
               minHeight: '200px',
               maxWidth: '200px',
               maxHeight: 'px',
               overflow: isOverDebug ? 'auto' : 'hidden'
             }"
             @mouseenter="isOverDebug = true"
             @mouseleave="isOverDebug = false">
          <h2>Debug...</h2>
        </div>
      </div>
    </bbn-pane>
    <bbn-pane ref="main">
      <bbn-tabnav :autoload="true"
                  :source="list"
                  :observer="true"
                  ref="tabnav">
      </bbn-tabnav>
    </bbn-pane>
    <bbn-pane :size="25"
              :scrollable="false"
              ref="foot"
              class="k-header"
              overflow="visible">
      <div class="bbn-w-50 bbn-h-100">
        <bbn-loading ref="loading"></bbn-loading>
      </div>
      <div class="bbn-h-100" style="float: right; width: 8rem;">
        <i :class="{
             'bbn-p': true,
             'bbn-xl': true,
             'fa': true,
             'fa-stack-exchange': true,
             'bbn-green': chatOnline,
             'bbn-red': !chatOnline
           }"
           @click="chatVisible = !chatVisible; if ( chatVisible && !chatOnline ){ chatOnline = true; }">
        </i>
        <i v-if="chatVisible && !getRef('chat').usersVisible"
           :class="{
             'bbn-p': true,
             'bbn-xl': true,
             'fa': true,
             'fa-users': true,
           }"
           @click="getRef('chat').usersVisible = true">
        </i>
        <i v-if="chatVisible && chatOnline"
           :class="{
             'bbn-p': true,
             'bbn-xl': true,
             'fa': true,
             'fa-ban': true,
           }"
           @click="chatOnline = false; chatVisible = false">
        </i>
      </div>
    </bbn-pane>
  </bbn-splitter>
  <bbn-treemenu source="menu/data"
                v-if="fisheyeMounted"
                ref="menu"
                :menus="menus"
                :current="currentMenu"
                :top="50"
                style="width: 350px"
                :shortcuts="$refs.fisheye"
                @ready="menuMounted = true">
  </bbn-treemenu>
  <bbn-popup :source="popups" ref="popup" :z-index="14"></bbn-popup>
  <bbn-notification ref="notification"></bbn-notification>
  <bbn-vlist v-for="(li, idx) in vlist"
             :key="idx"
             :left="li.left"
             :top="li.top"
             :right="li.right"
             :bottom="li.bottom"
             @close="vlist.splice(idx, 1)"
             :source="li.items"
             :unique="li.unique ? true : false">
  </bbn-vlist>
  <bbn-chat v-if="chatVisible"
            ref="chat"
            :width="lastKnownWidth"
            :user-id="app.userId"
            :users="app.users"
            :online-users="usersOnline"
            :online="chatOnline"
            @send="sendChatMessage"
            :groups="app.groups">
  </bbn-chat>
  <component ref="app" :is="appComponent"></component>
</div>