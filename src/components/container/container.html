<div :class="[componentClass, visual ? '' : 'bbn-overlay']"
     @subready.stop
     :style="visual ? visualStyle : {}"
     v-show="visible || visual">
  <div class="bbn-100">
    <transition name="fade"
                v-on:enter="enter"
                v-on:after-enter="onResize">
      <div :class="{
        'bbn-overlay': !visual,
        'bbn-flex-height': visual,
        'bbn-w-100': visual
      }"
          v-show="visible || visual">
        <!-- The header -->
        <div v-if="visual"
            :class="'bbn-b bbn-hpadded bbn-vspadded bbn-flex-width ' + (visible ? ' bbn-m' : '')"
            :style="{
              fontSize: isSelected && !router.visualShowAll ? null : '10em',
              backgroundColor: bcolor || '#666',
              color: fcolor || '#EEE'
            }">
          <div class="bbn-flex-fill bbn-vmiddle">
            <bbn-context v-if="visible"
                        class="bbn-right-sspace bbn-lg bbn-p"
                        :floater-title="_('Container menu')"
                        tag="span"
                        :source="showMenu">
              <i class="nf nf-fa-bars"/>
            </bbn-context>
            <span v-if="icon"
                  class="bbn-right-sspace bbn-lg">
              <i :class="icon"/>
            </span>
            <span v-text="title"
                  style="overflow: hidden"/>
          </div>
          <div v-if="isSelected && !static && !pinned"
              class="bbn-block bbn-p bbn-vmiddle bbn-h-100"
              @click="close">
            <i class="nf nf-fa-times bbn-lg"/>
          </div>
        </div>
        <!-- The main container (the one we take screenshots of) -->
        <div :class="{
          'bbn-background': true,
          'bbn-overlay': !fullScreen && !visual,
          'bbn-flex-fill': !fullScreen && visual,
          'bbn-container-full-screen': fullScreen,
          'bbn-container-visible': isSelected || visible
        }"
            ref="canvasSource">
          <!-- This is shown when it's ready -->
          <component :is="scrollable ? 'bbn-scroll' : 'div'"
                    v-if="ready && isLoaded && (isSelected || cached || visual)"
                    v-show="isSelected || (visual && !thumbnail)"
                    ref="scroll"
                    :axis="scrollable ? 'y' : null"
                    class="bbn-overlay">
            <!-- This is an ad hoc component with unique name -->
            <component v-if="isComponent"
                      :is="$options.components[componentName]"
                      :source="source"
                      ref="component"
            ></component>
            <!-- This is a classic component -->
            <component v-else-if="component"
                      :is="component"
                      :source="source"
                      ref="component"
                      v-bind="options"
            ></component>
            <!-- This is just HTML content -->
            <div v-else-if="content"
                v-html="content">
            </div>
            <!-- This is the slot -->
            <slot v-else></slot>
            <!-- Adding style as acomponent -->
            <component is="style"
                      v-if="css"
                      scoped="scoped"
                      v-html="css"/>
            <bbn-loader v-if="hasLoader"/>
          </component>
          <!-- If loading showing loader -->
          <bbn-loader v-else-if="isSelected && !isLoaded"/>
          <!-- Thumbnail image -->
          <div v-if="!isSelected && visual && thumbnail"
              style="overflow: hidden"
              class="bbn-overlay">
            <img :src="thumbnail"
                style="width: 100%; max-height: 100%; height: auto">
          </div>
          <!-- Icon for closing when in full screen mode -->
          <span  v-if="fullScreen"
                class="bbn-container-full-screen-closer bbn-xl bbn-p">
            <i class="nf nf-fa-times_circle"
              @click="fullScreen = false"/>
          </span>
          <!-- The container's popup, from each floater will come -->
          <bbn-popup ref="popup"
                    :source="popups"
                    v-if="!hidden && ready && isLoaded && (visible || cached)"/>
        </div>
      </div>
    </transition>
    <!-- When in visual mode a layer prevents interaction with the content -->
    <div v-if="visual && !isSelected"
        class="bbn-overlay"
        style="z-index: 12; background-color: black; opacity: 0.2;">
    </div>
    <div v-if="visual && (!isSelected || router.visualShowAll)"
        class="bbn-overlay"
        @click="router.selected = currentIndex"
        @mouseenter="isOver = true"
        @mouseleave="isOver = false"
        style="z-index: 12">
      <transition name="fade">
        <div class="bbn-bottom-left bbn-w-100"
            v-show="isOver"
            :style="{
                fontSize: isSelected ? null : '12em'
              }">
          <div class="bbn-bottom-left bbn-w-100 bbn-bg-black"
              style="opacity: 0.6; color: transparent">
              <div class="bbn-w-50 bbn-p bbn-spadded"
              @click.stop="">
            <i class="nf nf-fa-bars"/>
          </div>
          <div class="bbn-w-50 bbn-right bbn-p bbn-spadded"
              @click.stop="close"
              v-if="!pinned && !static">
              <i class="nf nf-fa-times"/>
          </div>
          <div class="bbn-w-50 bbn-right bbn-p bbn-spadded"
              @click.stop="unpin"
              v-else-if="pinned">
              <i class="nf nf-oct-pin"/>
          </div>
        </div>
          <div class="bbn-bottom-left bbn-w-100 bbn-white">
            <div class="bbn-w-50 bbn-p bbn-spadded"
                @click.stop="">
              <i class="nf nf-fa-bars"/>
            </div>
            <div class="bbn-w-50 bbn-right bbn-p bbn-spadded"
                @click.stop="close"
                v-if="!pinned && !static">
                <i class="nf nf-fa-times"/>
            </div>
            <div class="bbn-w-50 bbn-right bbn-p bbn-spadded"
                @click.stop="unpin"
                v-else-if="pinned">
                <i class="nf nf-oct-pin"/>
            </div>
          </div>
        </div>
      </transition>
    </div>
  </div>
</div>
